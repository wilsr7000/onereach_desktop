<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Settings</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: #1e1e1e;
            color: #e0e0e0;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }
        
        .header {
            background-color: #2d2d2d;
            padding: 20px;
            border-bottom: 1px solid #3e3e3e;
        }
        
        h1 {
            font-size: 24px;
            font-weight: 500;
        }
        
        .container {
            flex: 1;
            padding: 30px;
            max-width: 800px;
            margin: 0 auto;
            width: 100%;
        }
        
        .section {
            background-color: #2d2d2d;
            border-radius: 8px;
            padding: 24px;
            margin-bottom: 20px;
        }
        
        .section-title {
            font-size: 18px;
            font-weight: 500;
            margin-bottom: 20px;
            color: #fff;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-size: 14px;
            color: #b0b0b0;
        }
        
        input[type="text"],
        input[type="password"],
        select {
            width: 100%;
            padding: 10px 12px;
            background-color: #1e1e1e;
            border: 1px solid #3e3e3e;
            border-radius: 6px;
            color: #e0e0e0;
            font-size: 14px;
            transition: border-color 0.2s;
        }
        
        input[type="text"]:focus,
        input[type="password"]:focus,
        select:focus {
            outline: none;
            border-color: #0e639c;
        }
        
        .api-key-group {
            position: relative;
        }
        
        .toggle-visibility {
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: #b0b0b0;
            cursor: pointer;
            padding: 5px;
            font-size: 16px;
        }
        
        .toggle-visibility:hover {
            color: #e0e0e0;
        }
        
        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }
        
        .info-text {
            font-size: 12px;
            color: #888;
            margin-top: 5px;
        }
        
        .button-group {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
            margin-top: 30px;
        }
        
        button {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .btn-primary {
            background-color: #0e639c;
            color: white;
        }
        
        .btn-primary:hover {
            background-color: #1177bb;
        }
        
        .btn-secondary {
            background-color: #3e3e3e;
            color: #e0e0e0;
        }
        
        .btn-secondary:hover {
            background-color: #4e4e4e;
        }
        
        .status-message {
            padding: 12px;
            border-radius: 6px;
            margin-bottom: 20px;
            display: none;
        }
        
        .status-success {
            background-color: rgba(0, 200, 83, 0.1);
            border: 1px solid rgba(0, 200, 83, 0.3);
            color: #00c853;
        }
        
        .status-error {
            background-color: rgba(244, 67, 54, 0.1);
            border: 1px solid rgba(244, 67, 54, 0.3);
            color: #f44336;
        }
        
        .test-connection {
            display: inline-block;
            margin-left: 10px;
            font-size: 12px;
            color: #0e639c;
            cursor: pointer;
            text-decoration: none;
        }
        
        .test-connection:hover {
            text-decoration: underline;
        }
        
        .api-key-status {
            display: inline-block;
            margin-left: 10px;
            font-size: 12px;
        }
        
        .status-valid {
            color: #00c853;
        }
        
        .status-invalid {
            color: #f44336;
        }
        
        .divider {
            height: 1px;
            background-color: #3e3e3e;
            margin: 30px 0;
        }
        
        /* Dark scrollbar styling */
        ::-webkit-scrollbar {
            width: 12px;
            height: 12px;
        }
        
        ::-webkit-scrollbar-track {
            background-color: #1e1e1e;
            border-radius: 6px;
        }
        
        ::-webkit-scrollbar-thumb {
            background-color: #3e3e3e;
            border-radius: 6px;
            border: 2px solid #1e1e1e;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background-color: #4e4e4e;
        }
        
        ::-webkit-scrollbar-thumb:active {
            background-color: #5e5e5e;
        }
        
        /* Make scrollbar corners match */
        ::-webkit-scrollbar-corner {
            background-color: #1e1e1e;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>Settings</h1>
    </div>
    
    <div class="container">
        <div id="statusMessage" class="status-message"></div>
        
        <div class="section">
            <h2 class="section-title">LLM Configuration</h2>
            
            <div class="form-group">
                <label for="llmProvider">LLM Provider</label>
                <select id="llmProvider">
                    <option value="openai">OpenAI</option>
                    <option value="anthropic">Anthropic (Claude)</option>
                    <option value="google">Google (Gemini)</option>
                    <option value="mistral">Mistral</option>
                    <option value="custom">Custom Endpoint</option>
                </select>
            </div>
            
            <div class="form-group">
                <label for="llmModel">Model</label>
                <select id="llmModel">
                    <option value="gpt-5.1">GPT-5.1</option>
                    <option value="gpt-4o">GPT-4o</option>
                    <option value="gpt-4o-mini">GPT-4o Mini</option>
                    <option value="claude-sonnet-4-20250514">Claude Sonnet 4.5</option>
                    <option value="claude-opus-4-20250514">Claude Opus 4</option>
                    <option value="gemini-pro">Gemini Pro</option>
                    <option value="gemini-1.5-pro">Gemini 1.5 Pro</option>
                    <option value="mistral-large">Mistral Large</option>
                    <option value="mistral-medium">Mistral Medium</option>
                    <option value="mistral-small">Mistral Small</option>
                </select>
            </div>
            
            <div class="form-group api-key-group">
                <label for="llmApiKey">
                    API Key
                    <span id="apiKeyStatus" class="api-key-status"></span>
                    <a href="#" class="test-connection" onclick="testConnection()">Test Connection</a>
                </label>
                <div style="position: relative;">
                    <input type="password" id="llmApiKey" placeholder="Enter your API key">
                    <button class="toggle-visibility" onclick="toggleApiKeyVisibility()">üëÅ</button>
                </div>
                <div class="info-text">Your API key is encrypted and stored securely using your system's keychain</div>
            </div>
            
            <div class="form-group" id="claude4ThinkingGroup" style="display: none;">
                <label for="claude4ThinkingMode">Claude 4 Opus Thinking Mode</label>
                <select id="claude4ThinkingMode">
                    <option value="disabled">Disabled (Fast Response)</option>
                    <option value="enabled">Enabled (Extended Thinking)</option>
                </select>
                <div class="info-text">Enable extended thinking for complex reasoning and multi-step planning</div>
            </div>
            
            <div class="form-group" id="claude4ThinkingLevelGroup" style="display: none;">
                <label for="claude4ThinkingLevel">Thinking Level</label>
                <select id="claude4ThinkingLevel">
                    <option value="default">Default</option>
                    <option value="think">Think (~4k tokens)</option>
                    <option value="think-hard">Think Hard (~10k tokens)</option>
                    <option value="ultrathink">Ultra Think (~32k tokens)</option>
                </select>
                <div class="info-text">Higher thinking levels provide deeper analysis but increase cost and latency</div>
            </div>
            
            <div class="divider"></div>
            
            <h3 style="font-size: 16px; margin-bottom: 16px;">AI Image Editing (OpenAI DALL-E)</h3>
            
            <div class="form-group api-key-group">
                <label for="openaiApiKey">
                    OpenAI API Key
                    <span id="openaiKeyStatus" class="api-key-status"></span>
                </label>
                <div style="position: relative;">
                    <input type="password" id="openaiApiKey" placeholder="sk-... (required for AI image editing)">
                    <button class="toggle-visibility" onclick="toggleOpenAIKeyVisibility()">üëÅ</button>
                </div>
                <div class="info-text">Required for AI image editing and Whisper transcription. Get your key at <a href="https://platform.openai.com/api-keys" style="color: #8b5cf6;">platform.openai.com</a></div>
            </div>
            
            <div class="divider"></div>
            
            <h3 style="font-size: 16px; margin-bottom: 16px;">Speaker Recognition (AssemblyAI)</h3>
            
            <div class="form-group api-key-group">
                <label for="assemblyaiApiKey">
                    AssemblyAI API Key
                    <span id="assemblyaiKeyStatus" class="api-key-status"></span>
                </label>
                <div style="position: relative;">
                    <input type="password" id="assemblyaiApiKey" placeholder="(required for speaker recognition)">
                    <button class="toggle-visibility" onclick="toggleAssemblyAIKeyVisibility()">üëÅ</button>
                </div>
                <div class="info-text">Required for speaker recognition in videos. Get your key at <a href="https://www.assemblyai.com/app" style="color: #8b5cf6;">assemblyai.com</a></div>
            </div>
            
            <div class="divider"></div>
            
            <h3 style="font-size: 16px; margin-bottom: 16px;">AI Voice Generation (ElevenLabs)</h3>
            
            <div class="form-group api-key-group">
                <label for="elevenLabsApiKey">
                    ElevenLabs API Key
                    <span id="elevenLabsKeyStatus" class="api-key-status"></span>
                </label>
                <div style="position: relative;">
                    <input type="password" id="elevenLabsApiKey" placeholder="(required for AI voice generation)">
                    <button class="toggle-visibility" onclick="toggleElevenLabsKeyVisibility()">üëÅ</button>
                </div>
                <div class="info-text">Required for AI voice generation and audio replacement in video editor. Get your key at <a href="https://elevenlabs.io/app/settings/api-keys" style="color: #8b5cf6;">elevenlabs.io</a></div>
            </div>
            
            <div class="divider"></div>
            
            <h3 style="font-size: 16px; margin-bottom: 16px;">Video Release - YouTube Integration</h3>
            
            <div class="form-group api-key-group">
                <label for="youtubeClientId">
                    YouTube Client ID
                    <span id="youtubeClientIdStatus" class="api-key-status"></span>
                </label>
                <div style="position: relative;">
                    <input type="text" id="youtubeClientId" placeholder="(OAuth 2.0 Client ID from Google Cloud Console)">
                </div>
            </div>
            
            <div class="form-group api-key-group">
                <label for="youtubeClientSecret">
                    YouTube Client Secret
                    <span id="youtubeClientSecretStatus" class="api-key-status"></span>
                </label>
                <div style="position: relative;">
                    <input type="password" id="youtubeClientSecret" placeholder="(OAuth 2.0 Client Secret)">
                    <button class="toggle-visibility" onclick="toggleYouTubeSecretVisibility()">üëÅ</button>
                </div>
            </div>
            
            <div class="form-group" style="display: flex; align-items: center; gap: 12px;">
                <button class="btn" id="youtubeConnectBtn" onclick="connectYouTube()" style="background: #ff0000; color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer;">
                    ‚ñ∂Ô∏è Connect YouTube Account
                </button>
                <span id="youtubeConnectionStatus" style="font-size: 13px; color: #b0b0b0;"></span>
            </div>
            
            <div class="info-text">
                To enable direct YouTube uploads: 
                1. Go to <a href="https://console.cloud.google.com/apis/credentials" style="color: #8b5cf6;">Google Cloud Console</a>
                2. Create OAuth 2.0 credentials
                3. Add <code style="background: #1e1e1e; padding: 2px 6px; border-radius: 4px;">http://localhost:8089/oauth/callback</code> as redirect URI
                4. Enable YouTube Data API v3
            </div>
            
            <div class="divider"></div>
            
            <h3 style="font-size: 16px; margin-bottom: 16px;">Video Release - Vimeo Integration</h3>
            
            <div class="form-group api-key-group">
                <label for="vimeoClientId">
                    Vimeo Client ID
                    <span id="vimeoClientIdStatus" class="api-key-status"></span>
                </label>
                <div style="position: relative;">
                    <input type="text" id="vimeoClientId" placeholder="(OAuth Client ID from Vimeo Developer)">
                </div>
            </div>
            
            <div class="form-group api-key-group">
                <label for="vimeoClientSecret">
                    Vimeo Client Secret
                    <span id="vimeoClientSecretStatus" class="api-key-status"></span>
                </label>
                <div style="position: relative;">
                    <input type="password" id="vimeoClientSecret" placeholder="(OAuth Client Secret)">
                    <button class="toggle-visibility" onclick="toggleVimeoSecretVisibility()">üëÅ</button>
                </div>
            </div>
            
            <div class="form-group" style="display: flex; align-items: center; gap: 12px;">
                <button class="btn" id="vimeoConnectBtn" onclick="connectVimeo()" style="background: #1ab7ea; color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer;">
                    üé¨ Connect Vimeo Account
                </button>
                <span id="vimeoConnectionStatus" style="font-size: 13px; color: #b0b0b0;"></span>
            </div>
            
            <div class="info-text">
                To enable direct Vimeo uploads:
                1. Go to <a href="https://developer.vimeo.com/apps" style="color: #8b5cf6;">Vimeo Developer Apps</a>
                2. Create a new app
                3. Add <code style="background: #1e1e1e; padding: 2px 6px; border-radius: 4px;">http://localhost:8090/oauth/callback</code> as redirect URI
                4. Request upload scope
            </div>
            
            <div class="divider"></div>
            
            <h3 style="font-size: 16px; margin-bottom: 16px;">AI Features</h3>
            
            <div class="form-group">
                <div class="checkbox-group">
                    <input type="checkbox" id="autoAIMetadata">
                    <label for="autoAIMetadata" style="margin-bottom: 0;">Auto-generate AI metadata for clipboard items</label>
                </div>
                <div class="info-text">Automatically analyze clipboard content and generate descriptions, tags, and notes using Claude Sonnet 4.5 (requires API key)</div>
            </div>
            
            <div class="form-group" id="autoAIMetadataTypesGroup" style="display: block;">
                <label>Content types to auto-analyze:</label>
                <div style="display: flex; flex-wrap: wrap; gap: 12px; margin-top: 8px;">
                    <label style="display: flex; align-items: center; gap: 6px; cursor: pointer;">
                        <input type="checkbox" id="aiTypeAll" value="all" style="width: 14px; height: 14px;" checked>
                        <span style="font-size: 13px;">All types</span>
                    </label>
                    <label style="display: flex; align-items: center; gap: 6px; cursor: pointer;">
                        <input type="checkbox" id="aiTypeImage" value="image" style="width: 14px; height: 14px;" checked disabled>
                        <span style="font-size: 13px;">Images</span>
                    </label>
                    <label style="display: flex; align-items: center; gap: 6px; cursor: pointer;">
                        <input type="checkbox" id="aiTypeScreenshot" value="screenshot" style="width: 14px; height: 14px;" checked disabled>
                        <span style="font-size: 13px;">Screenshots</span>
                    </label>
                    <label style="display: flex; align-items: center; gap: 6px; cursor: pointer;">
                        <input type="checkbox" id="aiTypeCode" value="code" style="width: 14px; height: 14px;" checked disabled>
                        <span style="font-size: 13px;">Code</span>
                    </label>
                    <label style="display: flex; align-items: center; gap: 6px; cursor: pointer;">
                        <input type="checkbox" id="aiTypeText" value="text" style="width: 14px; height: 14px;" checked disabled>
                        <span style="font-size: 13px;">Text</span>
                    </label>
                    <label style="display: flex; align-items: center; gap: 6px; cursor: pointer;">
                        <input type="checkbox" id="aiTypeHtml" value="html" style="width: 14px; height: 14px;" checked disabled>
                        <span style="font-size: 13px;">HTML</span>
                    </label>
                    <label style="display: flex; align-items: center; gap: 6px; cursor: pointer;">
                        <input type="checkbox" id="aiTypeFile" value="file" style="width: 14px; height: 14px;" checked disabled>
                        <span style="font-size: 13px;">Files</span>
                    </label>
                </div>
                <div class="info-text" style="margin-top: 8px;">Select which types of content should be automatically analyzed when captured</div>
            </div>
            
            <div class="form-group">
                <div class="checkbox-group">
                    <input type="checkbox" id="autoGenerateScreenshotMetadata">
                    <label for="autoGenerateScreenshotMetadata" style="margin-bottom: 0;">Legacy: Auto-analyze screenshots only</label>
                </div>
                <div class="info-text">‚ö†Ô∏è Deprecated - use the new "Auto-generate AI metadata" option above instead</div>
            </div>
        </div>
        
        <div class="section">
            <h2 class="section-title">GSX File Sync Configuration</h2>
            
            <div class="form-group">
                <label for="gsxEnvironment">GSX Environment</label>
                <select id="gsxEnvironment" onchange="console.log('Environment changed to:', this.value)">
                    <option value="production">Production</option>
                    <option value="edison">Edison</option>
                    <option value="staging">Staging</option>
                    <option value="qa">QA</option>
                </select>
                <div class="info-text">Select the environment where you obtained your token</div>
            </div>
            
            <div class="form-group api-key-group">
                <label for="gsxToken">
                    GSX Token
                    <span id="gsxTokenStatus" class="api-key-status"></span>
                    <a href="#" class="test-connection" onclick="testGSXConnection()">Test Connection</a>
                </label>
                <div style="position: relative;">
                    <input type="password" id="gsxToken" placeholder="Paste your OneReach GSX token here">
                    <button class="toggle-visibility" onclick="toggleGSXTokenVisibility()">üëÅ</button>
                </div>
                <div style="margin-top: 10px;">
                    <button class="btn-secondary" onclick="pasteGSXToken()" style="padding: 6px 12px; font-size: 12px;">
                        üìã Paste Token from Clipboard
                    </button>
                    <button class="btn-secondary" onclick="refreshGSXToken()" style="padding: 6px 12px; font-size: 12px; margin-left: 10px;">
                        üîÑ Refresh Token
                    </button>
                    <button class="btn-secondary" onclick="clearGSXToken()" style="padding: 6px 12px; font-size: 12px; margin-left: 10px;">
                        üóëÔ∏è Clear Token
                    </button>
                </div>
                <div class="info-text">
                    <strong>How to get your token:</strong> Log into OneReach ‚Üí Account Settings ‚Üí API Tokens ‚Üí Generate New Token<br>
                    Your token is encrypted and stored securely in your system keychain
                </div>
            </div>
            
            <div class="form-group">
                <label for="gsxAccountId">
                    GSX Account ID (Optional)
                </label>
                <input type="text" id="gsxAccountId" placeholder="e.g. 05bd3c92-5d3c-4dc5-a95d-0c584695cea4">
                <div class="info-text">
                    Your account ID from GSX (optional - found in user preferences or URL)
                </div>
            </div>
            
            <div class="divider"></div>
            
            <h3 style="font-size: 16px; margin-bottom: 16px;">Auto-Sync Settings</h3>
            
            <div class="form-group">
                <div class="checkbox-group">
                    <input type="checkbox" id="gsxAutoSync">
                    <label for="gsxAutoSync" style="margin-bottom: 0;">Enable Auto-Sync</label>
                </div>
                <div class="info-text">Automatically sync configured directories to GSX Files</div>
            </div>
            
            <div class="form-group">
                <label for="gsxSyncInterval">Sync Interval</label>
                <select id="gsxSyncInterval">
                    <option value="hourly">Hourly</option>
                    <option value="daily">Daily</option>
                    <option value="weekly">Weekly</option>
                    <option value="manual">Manual Only</option>
                </select>
                <div class="info-text">How often to automatically sync files to GSX</div>
            </div>
            
            <div class="form-group">
                <button class="btn-primary" onclick="syncCompleteBackup()" style="padding: 12px 24px;">
                    üîí Complete Backup (Recommended)
                </button>
                <button class="btn-secondary" onclick="syncNow()" style="margin-left: 10px;">Quick Sync</button>
                <div class="info-text">
                    <strong>Complete Backup</strong> syncs everything needed to restore on a new machine:<br>
                    ‚Ä¢ OR-Spaces (clipboard data, items, spaces)<br>
                    ‚Ä¢ App Configuration (settings, IDW entries, GSX links)<br>
                    ‚Ä¢ Reading logs and preferences
                </div>
            </div>
        </div>
        
        <div class="section">
            <h2 class="section-title">General Settings</h2>
            
            <div class="form-group">
                <label for="theme">Theme</label>
                <select id="theme">
                    <option value="dark">Dark</option>
                    <option value="light">Light</option>
                    <option value="system">System</option>
                </select>
            </div>
            
            <div class="form-group">
                <div class="checkbox-group">
                    <input type="checkbox" id="autoSave">
                    <label for="autoSave" style="margin-bottom: 0;">Enable Auto-Save</label>
                </div>
                <div class="info-text">Automatically save settings when changed</div>
            </div>
        </div>
        
        <div class="section">
            <h2 class="section-title">Learning API Settings</h2>
            
            <div class="form-group">
                <label for="learningApiUrl">Quick Starts API URL</label>
                <div style="display: flex; gap: 10px;">
                    <input type="text" id="learningApiUrl" placeholder="https://em.staging.api.onereach.ai/http/..." style="flex: 1;">
                    <button class="btn-secondary" onclick="testLearningApi()" style="min-width: 100px;">Test API</button>
                </div>
                <div class="info-text">API endpoint for Quick Starts tutorials content</div>
                <div id="learningApiStatus" class="api-key-status" style="display: none; margin-top: 5px;"></div>
            </div>
            
            <div class="form-group">
                <label for="learningApiMethod">API Method</label>
                <select id="learningApiMethod">
                    <option value="POST">POST</option>
                    <option value="GET">GET</option>
                </select>
                <div class="info-text">HTTP method for the API request (usually POST)</div>
            </div>
            
            <div class="form-group">
                <div class="checkbox-group">
                    <input type="checkbox" id="learningApiCache">
                    <label for="learningApiCache" style="margin-bottom: 0;">Enable Response Caching</label>
                </div>
                <div class="info-text">Cache API responses for 5 minutes to improve performance</div>
            </div>
        </div>
        
        <div class="button-group">
            <button class="btn-secondary" onclick="window.close()">Cancel</button>
            <button class="btn-primary" onclick="saveSettings()">Save Settings</button>
        </div>
    </div>
    
    <script>
        let settings = {};
        let apiKeyVisible = false;
        let openaiKeyVisible = false;
        let assemblyaiKeyVisible = false;
        let elevenLabsKeyVisible = false;
        let gsxTokenVisible = false;
        let youtubeSecretVisible = false;
        let vimeoSecretVisible = false;
        
        // Load settings when window opens
        window.addEventListener('DOMContentLoaded', async () => {
            await loadSettings();
        });
        
        async function loadSettings() {
            try {
                settings = await window.api.getSettings();
                
                // Populate form fields
                document.getElementById('llmProvider').value = settings.llmProvider || 'openai';
                document.getElementById('llmModel').value = settings.llmModel || 'gpt-4';
                document.getElementById('llmApiKey').value = settings.llmApiKey || '';
                document.getElementById('openaiApiKey').value = settings.openaiApiKey || '';
                document.getElementById('assemblyaiApiKey').value = settings.assemblyaiApiKey || '';
                document.getElementById('theme').value = settings.theme || 'dark';
                document.getElementById('autoSave').checked = settings.autoSave !== false;
                document.getElementById('autoGenerateScreenshotMetadata').checked = settings.autoGenerateScreenshotMetadata === true;
                
                // Auto AI Metadata settings
                const autoAIEnabled = settings.autoAIMetadata !== false; // Default to true
                document.getElementById('autoAIMetadata').checked = autoAIEnabled;
                document.getElementById('autoAIMetadataTypesGroup').style.display = autoAIEnabled ? 'block' : 'none';
                
                // Load AI metadata types (default to 'all')
                const aiTypes = settings.autoAIMetadataTypes || ['all'];
                const isAllTypes = aiTypes.includes('all');
                
                document.getElementById('aiTypeAll').checked = isAllTypes;
                document.getElementById('aiTypeImage').checked = aiTypes.includes('image') || isAllTypes;
                document.getElementById('aiTypeScreenshot').checked = aiTypes.includes('screenshot') || isAllTypes;
                document.getElementById('aiTypeCode').checked = aiTypes.includes('code') || isAllTypes;
                document.getElementById('aiTypeText').checked = aiTypes.includes('text') || isAllTypes;
                document.getElementById('aiTypeHtml').checked = aiTypes.includes('html') || isAllTypes;
                document.getElementById('aiTypeFile').checked = aiTypes.includes('file') || isAllTypes;
                
                // Disable individual checkboxes when "All" is selected
                document.getElementById('aiTypeImage').disabled = isAllTypes;
                document.getElementById('aiTypeScreenshot').disabled = isAllTypes;
                document.getElementById('aiTypeCode').disabled = isAllTypes;
                document.getElementById('aiTypeText').disabled = isAllTypes;
                document.getElementById('aiTypeHtml').disabled = isAllTypes;
                document.getElementById('aiTypeFile').disabled = isAllTypes;
                
                // GSX Settings
                document.getElementById('gsxToken').value = settings.gsxToken || '';
                document.getElementById('gsxEnvironment').value = settings.gsxEnvironment || 'production';
                document.getElementById('gsxAccountId').value = settings.gsxAccountId || '';
                document.getElementById('gsxAutoSync').checked = settings.gsxAutoSync === true;
                document.getElementById('gsxSyncInterval').value = settings.gsxSyncInterval || 'daily';
                
                // Learning API Settings
                document.getElementById('learningApiUrl').value = settings.learningApiUrl || 'https://em.staging.api.onereach.ai/http/48cc49ef-ab05-4d51-acc6-559c7ff22150/idw_quick_starts';
                document.getElementById('learningApiMethod').value = settings.learningApiMethod || 'POST';
                document.getElementById('learningApiCache').checked = settings.learningApiCache !== false;
                
                // Check if GSX token exists
                if (settings.gsxToken) {
                    document.getElementById('gsxTokenStatus').textContent = '(Token saved)';
                    document.getElementById('gsxTokenStatus').className = 'api-key-status status-valid';
                }
                
                // Update model options based on provider
                updateModelOptions();
                
                // Load Claude 4 thinking settings
                if (settings.claude4ThinkingMode) {
                    document.getElementById('claude4ThinkingMode').value = settings.claude4ThinkingMode;
                }
                if (settings.claude4ThinkingLevel) {
                    document.getElementById('claude4ThinkingLevel').value = settings.claude4ThinkingLevel;
                }
                
                // Show Claude 4 options if Claude 4 Opus is selected
                if (settings.llmModel === 'claude-opus-4-20250514') {
                    document.getElementById('claude4ThinkingGroup').style.display = 'block';
                    if (settings.claude4ThinkingMode === 'enabled') {
                        document.getElementById('claude4ThinkingLevelGroup').style.display = 'block';
                    }
                }
                
                // Check if API key exists
                if (settings.llmApiKey) {
                    document.getElementById('apiKeyStatus').textContent = '(Key saved)';
                    document.getElementById('apiKeyStatus').className = 'api-key-status status-valid';
                }
                
                // Check if OpenAI API key exists
                if (settings.openaiApiKey) {
                    document.getElementById('openaiKeyStatus').textContent = '(Key saved)';
                    document.getElementById('openaiKeyStatus').className = 'api-key-status status-valid';
                }
                
                // Check if AssemblyAI API key exists
                if (settings.assemblyaiApiKey) {
                    document.getElementById('assemblyaiKeyStatus').textContent = '(Key saved)';
                    document.getElementById('assemblyaiKeyStatus').className = 'api-key-status status-valid';
                }
                
                // Load ElevenLabs API key
                document.getElementById('elevenLabsApiKey').value = settings.elevenLabsApiKey || '';

                // Check if ElevenLabs API key exists
                if (settings.elevenLabsApiKey) {
                    document.getElementById('elevenLabsKeyStatus').textContent = '(Key saved)';
                    document.getElementById('elevenLabsKeyStatus').className = 'api-key-status status-valid';
                }
                
                // Load YouTube credentials
                document.getElementById('youtubeClientId').value = settings.youtubeClientId || '';
                document.getElementById('youtubeClientSecret').value = settings.youtubeClientSecret || '';
                
                if (settings.youtubeClientId) {
                    document.getElementById('youtubeClientIdStatus').textContent = '(Saved)';
                    document.getElementById('youtubeClientIdStatus').className = 'api-key-status status-valid';
                }
                
                // Load Vimeo credentials
                document.getElementById('vimeoClientId').value = settings.vimeoClientId || '';
                document.getElementById('vimeoClientSecret').value = settings.vimeoClientSecret || '';
                
                if (settings.vimeoClientId) {
                    document.getElementById('vimeoClientIdStatus').textContent = '(Saved)';
                    document.getElementById('vimeoClientIdStatus').className = 'api-key-status status-valid';
                }
                
                // Check video release connections
                checkVideoReleaseConnections();
            } catch (error) {
                console.error('Error loading settings:', error);
                showStatus('Error loading settings', 'error');
            }
        }
        
        async function saveSettings() {
            // Collect AI metadata types
            const aiMetadataTypes = [];
            if (document.getElementById('aiTypeAll').checked) {
                aiMetadataTypes.push('all');
            } else {
                if (document.getElementById('aiTypeImage').checked) aiMetadataTypes.push('image');
                if (document.getElementById('aiTypeScreenshot').checked) aiMetadataTypes.push('screenshot');
                if (document.getElementById('aiTypeCode').checked) aiMetadataTypes.push('code');
                if (document.getElementById('aiTypeText').checked) aiMetadataTypes.push('text');
                if (document.getElementById('aiTypeHtml').checked) aiMetadataTypes.push('html');
                if (document.getElementById('aiTypeFile').checked) aiMetadataTypes.push('file');
            }
            
            const newSettings = {
                llmProvider: document.getElementById('llmProvider').value,
                llmModel: document.getElementById('llmModel').value,
                llmApiKey: document.getElementById('llmApiKey').value,
                openaiApiKey: document.getElementById('openaiApiKey').value,
                assemblyaiApiKey: document.getElementById('assemblyaiApiKey').value,
                elevenLabsApiKey: document.getElementById('elevenLabsApiKey').value,
                youtubeClientId: document.getElementById('youtubeClientId').value,
                youtubeClientSecret: document.getElementById('youtubeClientSecret').value,
                vimeoClientId: document.getElementById('vimeoClientId').value,
                vimeoClientSecret: document.getElementById('vimeoClientSecret').value,
                theme: document.getElementById('theme').value,
                autoSave: document.getElementById('autoSave').checked,
                claude4ThinkingMode: document.getElementById('claude4ThinkingMode').value,
                claude4ThinkingLevel: document.getElementById('claude4ThinkingLevel').value,
                autoGenerateScreenshotMetadata: document.getElementById('autoGenerateScreenshotMetadata').checked,
                autoAIMetadata: document.getElementById('autoAIMetadata').checked,
                autoAIMetadataTypes: aiMetadataTypes,
                gsxToken: document.getElementById('gsxToken').value,
                gsxEnvironment: document.getElementById('gsxEnvironment').value,
                gsxAccountId: document.getElementById('gsxAccountId').value,
                gsxAutoSync: document.getElementById('gsxAutoSync').checked,
                gsxSyncInterval: document.getElementById('gsxSyncInterval').value,
                learningApiUrl: document.getElementById('learningApiUrl').value,
                learningApiMethod: document.getElementById('learningApiMethod').value,
                learningApiCache: document.getElementById('learningApiCache').checked
            };
            
            try {
                const result = await window.api.saveSettings(newSettings);
                if (result) {
                    showStatus('Settings saved successfully', 'success');
                    setTimeout(() => {
                        window.close();
                    }, 1000);
                } else {
                    showStatus('Error saving settings', 'error');
                }
            } catch (error) {
                console.error('Error saving settings:', error);
                showStatus('Error saving settings', 'error');
            }
        }
        
        async function testLearningApi() {
            const url = document.getElementById('learningApiUrl').value;
            const method = document.getElementById('learningApiMethod').value;
            const statusDiv = document.getElementById('learningApiStatus');
            
            if (!url) {
                showApiStatus(statusDiv, 'Please enter an API URL', 'error');
                return;
            }
            
            showApiStatus(statusDiv, 'Testing API connection...', 'info');
            
            try {
                const response = await fetch(url, {
                    method: method,
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    },
                    body: method === 'POST' ? '{}' : undefined
                });
                
                if (response.ok) {
                    const data = await response.json();
                    if (data && data.user && data.categories) {
                        showApiStatus(statusDiv, `‚úÖ API working! Found ${Object.keys(data.categories).length} categories`, 'success');
                    } else {
                        showApiStatus(statusDiv, '‚ö†Ô∏è API responded but data format may be incorrect', 'warning');
                    }
                } else {
                    showApiStatus(statusDiv, `‚ùå API error: ${response.status} ${response.statusText}`, 'error');
                }
            } catch (error) {
                showApiStatus(statusDiv, `‚ùå Connection failed: ${error.message}`, 'error');
            }
        }
        
        function showApiStatus(element, message, type) {
            element.textContent = message;
            element.className = 'api-key-status';
            if (type === 'success') {
                element.className += ' status-valid';
            } else if (type === 'error') {
                element.className += ' status-invalid';
            }
            element.style.display = 'block';
        }
        
        function toggleApiKeyVisibility() {
            const input = document.getElementById('llmApiKey');
            const button = input.parentElement.querySelector('.toggle-visibility');
            
            if (apiKeyVisible) {
                input.type = 'password';
                button.textContent = 'üëÅ';
                apiKeyVisible = false;
            } else {
                input.type = 'text';
                button.textContent = 'üôà';
                apiKeyVisible = true;
            }
        }
        
        function toggleOpenAIKeyVisibility() {
            const input = document.getElementById('openaiApiKey');
            const button = input.parentElement.querySelector('.toggle-visibility');
            
            if (openaiKeyVisible) {
                input.type = 'password';
                button.textContent = 'üëÅ';
                openaiKeyVisible = false;
            } else {
                input.type = 'text';
                button.textContent = 'üôà';
                openaiKeyVisible = true;
            }
        }
        
        function toggleAssemblyAIKeyVisibility() {
            const input = document.getElementById('assemblyaiApiKey');
            const button = input.parentElement.querySelector('.toggle-visibility');
            
            if (assemblyaiKeyVisible) {
                input.type = 'password';
                button.textContent = 'üëÅ';
                assemblyaiKeyVisible = false;
            } else {
                input.type = 'text';
                button.textContent = 'üôà';
                assemblyaiKeyVisible = true;
            }
        }
        
        function toggleElevenLabsKeyVisibility() {
            const input = document.getElementById('elevenLabsApiKey');
            const button = input.parentElement.querySelector('.toggle-visibility');
            
            if (elevenLabsKeyVisible) {
                input.type = 'password';
                button.textContent = 'üëÅ';
                elevenLabsKeyVisible = false;
            } else {
                input.type = 'text';
                button.textContent = 'üôà';
                elevenLabsKeyVisible = true;
            }
        }
        
        function toggleYouTubeSecretVisibility() {
            const input = document.getElementById('youtubeClientSecret');
            const button = input.parentElement.querySelector('.toggle-visibility');
            
            if (youtubeSecretVisible) {
                input.type = 'password';
                button.textContent = 'üëÅ';
                youtubeSecretVisible = false;
            } else {
                input.type = 'text';
                button.textContent = 'üôà';
                youtubeSecretVisible = true;
            }
        }
        
        function toggleVimeoSecretVisibility() {
            const input = document.getElementById('vimeoClientSecret');
            const button = input.parentElement.querySelector('.toggle-visibility');
            
            if (vimeoSecretVisible) {
                input.type = 'password';
                button.textContent = 'üëÅ';
                vimeoSecretVisible = false;
            } else {
                input.type = 'text';
                button.textContent = 'üôà';
                vimeoSecretVisible = true;
            }
        }
        
        async function connectYouTube() {
            const clientId = document.getElementById('youtubeClientId').value;
            const clientSecret = document.getElementById('youtubeClientSecret').value;
            
            if (!clientId || !clientSecret) {
                showStatus('Please enter YouTube Client ID and Secret first', 'error');
                return;
            }
            
            document.getElementById('youtubeConnectionStatus').textContent = 'Connecting...';
            
            try {
                // First save the credentials
                await window.api.saveSettings({
                    youtubeClientId: clientId,
                    youtubeClientSecret: clientSecret
                });
                
                // Then initiate OAuth
                const result = await window.api.authenticateYouTube();
                
                if (result.success) {
                    const channelName = result.channel?.title || 'Connected';
                    document.getElementById('youtubeConnectionStatus').innerHTML = 
                        `<span style="color: #22c55e;">‚úì Connected as ${channelName}</span>`;
                    showStatus('YouTube connected successfully!', 'success');
                } else {
                    document.getElementById('youtubeConnectionStatus').innerHTML = 
                        `<span style="color: #ef4444;">‚úó ${result.error || 'Connection failed'}</span>`;
                }
            } catch (error) {
                document.getElementById('youtubeConnectionStatus').innerHTML = 
                    `<span style="color: #ef4444;">‚úó ${error.message}</span>`;
                showStatus('YouTube connection failed: ' + error.message, 'error');
            }
        }
        
        async function connectVimeo() {
            const clientId = document.getElementById('vimeoClientId').value;
            const clientSecret = document.getElementById('vimeoClientSecret').value;
            
            if (!clientId || !clientSecret) {
                showStatus('Please enter Vimeo Client ID and Secret first', 'error');
                return;
            }
            
            document.getElementById('vimeoConnectionStatus').textContent = 'Connecting...';
            
            try {
                // First save the credentials
                await window.api.saveSettings({
                    vimeoClientId: clientId,
                    vimeoClientSecret: clientSecret
                });
                
                // Then initiate OAuth
                const result = await window.api.authenticateVimeo();
                
                if (result.success) {
                    const userName = result.user?.name || 'Connected';
                    document.getElementById('vimeoConnectionStatus').innerHTML = 
                        `<span style="color: #22c55e;">‚úì Connected as ${userName}</span>`;
                    showStatus('Vimeo connected successfully!', 'success');
                } else {
                    document.getElementById('vimeoConnectionStatus').innerHTML = 
                        `<span style="color: #ef4444;">‚úó ${result.error || 'Connection failed'}</span>`;
                }
            } catch (error) {
                document.getElementById('vimeoConnectionStatus').innerHTML = 
                    `<span style="color: #ef4444;">‚úó ${error.message}</span>`;
                showStatus('Vimeo connection failed: ' + error.message, 'error');
            }
        }
        
        async function checkVideoReleaseConnections() {
            // Check YouTube connection
            try {
                const ytStatus = await window.api.getYouTubeStatus();
                if (ytStatus.authenticated) {
                    document.getElementById('youtubeConnectionStatus').innerHTML = 
                        `<span style="color: #22c55e;">‚úì Connected as ${ytStatus.channel?.title || 'Unknown'}</span>`;
                } else if (ytStatus.configured) {
                    document.getElementById('youtubeConnectionStatus').textContent = 'Not connected';
                }
            } catch (e) { /* ignore */ }
            
            // Check Vimeo connection
            try {
                const vimeoStatus = await window.api.getVimeoStatus();
                if (vimeoStatus.authenticated) {
                    document.getElementById('vimeoConnectionStatus').innerHTML = 
                        `<span style="color: #22c55e;">‚úì Connected as ${vimeoStatus.user?.name || 'Unknown'}</span>`;
                } else if (vimeoStatus.configured) {
                    document.getElementById('vimeoConnectionStatus').textContent = 'Not connected';
                }
            } catch (e) { /* ignore */ }
        }
        
        function updateModelOptions() {
            const provider = document.getElementById('llmProvider').value;
            const modelSelect = document.getElementById('llmModel');
            
            // Clear current options
            modelSelect.innerHTML = '';
            
            // Hide Claude 4 thinking options by default
            document.getElementById('claude4ThinkingGroup').style.display = 'none';
            document.getElementById('claude4ThinkingLevelGroup').style.display = 'none';
            
            // Add options based on provider
            let options = [];
            switch (provider) {
                case 'openai':
                    options = [
                        { value: 'gpt-5.1', text: 'GPT-5.1' },
                        { value: 'gpt-4o', text: 'GPT-4o' },
                        { value: 'gpt-4o-mini', text: 'GPT-4o Mini' }
                    ];
                    break;
                case 'anthropic':
                    options = [
                        { value: 'claude-sonnet-4-20250514', text: 'Claude Sonnet 4.5' },
                        { value: 'claude-opus-4-20250514', text: 'Claude Opus 4' }
                    ];
                    break;
                case 'google':
                    options = [
                        { value: 'gemini-1.5-pro', text: 'Gemini 1.5 Pro' },
                        { value: 'gemini-pro', text: 'Gemini Pro' },
                        { value: 'gemini-1.5-flash', text: 'Gemini 1.5 Flash' }
                    ];
                    break;
                case 'mistral':
                    options = [
                        { value: 'mistral-large', text: 'Mistral Large' },
                        { value: 'mistral-medium', text: 'Mistral Medium' },
                        { value: 'mistral-small', text: 'Mistral Small' }
                    ];
                    break;
                case 'custom':
                    options = [
                        { value: 'custom', text: 'Custom Model' }
                    ];
                    break;
            }
            
            options.forEach(opt => {
                const option = document.createElement('option');
                option.value = opt.value;
                option.textContent = opt.text;
                modelSelect.appendChild(option);
            });
        }
        
        async function testConnection() {
            const provider = document.getElementById('llmProvider').value;
            const apiKey = document.getElementById('llmApiKey').value;
            const model = document.getElementById('llmModel').value;
            
            if (!apiKey) {
                showStatus('Please enter an API key first', 'error');
                return;
            }
            
            showStatus('Testing connection...', 'success');
            
            try {
                const result = await window.api.testLLMConnection({ provider, apiKey, model });
                if (result.success) {
                    showStatus('Connection successful!', 'success');
                    document.getElementById('apiKeyStatus').textContent = '(Valid)';
                    document.getElementById('apiKeyStatus').className = 'api-key-status status-valid';
                } else {
                    showStatus(`Connection failed: ${result.error}`, 'error');
                    document.getElementById('apiKeyStatus').textContent = '(Invalid)';
                    document.getElementById('apiKeyStatus').className = 'api-key-status status-invalid';
                }
            } catch (error) {
                showStatus(`Error testing connection: ${error.message}`, 'error');
            }
        }
        
        function showStatus(message, type) {
            const statusEl = document.getElementById('statusMessage');
            statusEl.textContent = message;
            statusEl.className = `status-message status-${type}`;
            statusEl.style.display = 'block';
            
            // Auto-hide after 5 seconds
            setTimeout(() => {
                statusEl.style.display = 'none';
            }, 5000);
        }
        
        // Handle provider change
        document.getElementById('llmProvider').addEventListener('change', updateModelOptions);
        
        // Handle model change to show/hide Claude 4 options
        document.getElementById('llmModel').addEventListener('change', (e) => {
            const selectedModel = e.target.value;
            
            if (selectedModel === 'claude-opus-4-20250514') {
                document.getElementById('claude4ThinkingGroup').style.display = 'block';
                const thinkingMode = document.getElementById('claude4ThinkingMode').value;
                if (thinkingMode === 'enabled') {
                    document.getElementById('claude4ThinkingLevelGroup').style.display = 'block';
                }
            } else {
                document.getElementById('claude4ThinkingGroup').style.display = 'none';
                document.getElementById('claude4ThinkingLevelGroup').style.display = 'none';
            }
        });
        
        // Handle thinking mode change
        document.getElementById('claude4ThinkingMode').addEventListener('change', (e) => {
            if (e.target.value === 'enabled') {
                document.getElementById('claude4ThinkingLevelGroup').style.display = 'block';
            } else {
                document.getElementById('claude4ThinkingLevelGroup').style.display = 'none';
            }
        });
        
        // Auto-save if enabled
        document.getElementById('autoSave').addEventListener('change', (e) => {
            if (e.target.checked) {
                saveSettings();
            }
        });
        
        // Handle auto AI metadata toggle
        document.getElementById('autoAIMetadata').addEventListener('change', (e) => {
            document.getElementById('autoAIMetadataTypesGroup').style.display = e.target.checked ? 'block' : 'none';
        });
        
        // Handle "All types" checkbox - toggle all other checkboxes
        document.getElementById('aiTypeAll').addEventListener('change', (e) => {
            const checked = e.target.checked;
            document.getElementById('aiTypeImage').checked = checked;
            document.getElementById('aiTypeScreenshot').checked = checked;
            document.getElementById('aiTypeCode').checked = checked;
            document.getElementById('aiTypeText').checked = checked;
            document.getElementById('aiTypeHtml').checked = checked;
            document.getElementById('aiTypeFile').checked = checked;
            
            // Disable individual checkboxes when "All" is selected
            document.getElementById('aiTypeImage').disabled = checked;
            document.getElementById('aiTypeScreenshot').disabled = checked;
            document.getElementById('aiTypeCode').disabled = checked;
            document.getElementById('aiTypeText').disabled = checked;
            document.getElementById('aiTypeHtml').disabled = checked;
            document.getElementById('aiTypeFile').disabled = checked;
        });
        
        function toggleGSXTokenVisibility() {
            const input = document.getElementById('gsxToken');
            const button = event.target;
            
            if (gsxTokenVisible) {
                input.type = 'password';
                button.textContent = 'üëÅ';
                gsxTokenVisible = false;
            } else {
                input.type = 'text';
                button.textContent = 'üôà';
                gsxTokenVisible = true;
            }
        }
        
        async function testGSXConnection() {
            const token = document.getElementById('gsxToken').value;
            const environment = document.getElementById('gsxEnvironment').value;
            const accountId = document.getElementById('gsxAccountId').value;
            
            if (!token) {
                showStatus('Please enter a GSX token first', 'error');
                return;
            }
            
            console.log('Testing connection with:');
            console.log('- Environment:', environment);
            console.log('- Token length:', token.length);
            console.log('- Token starts:', token.substring(0, 20));
            console.log('- Token ends:', token.substring(token.length - 20));
            console.log('- Account ID:', accountId || 'not provided');
            
            showStatus('Testing GSX connection...', 'success');
            
            try {
                const result = await window.api.testGSXConnection({ token, environment, accountId });
                console.log('Test result:', result);
                
                if (result.success) {
                    showStatus('GSX connection successful!', 'success');
                    document.getElementById('gsxTokenStatus').textContent = '(Valid)';
                    document.getElementById('gsxTokenStatus').className = 'api-key-status status-valid';
                } else {
                    showStatus(`GSX connection failed: ${result.error}`, 'error');
                    document.getElementById('gsxTokenStatus').textContent = '(Invalid)';
                    document.getElementById('gsxTokenStatus').className = 'api-key-status status-invalid';
                }
            } catch (error) {
                showStatus(`Error testing GSX connection: ${error.message}`, 'error');
            }
        }
        
        async function configureSyncPaths() {
            // This would open a dialog to configure sync paths
            showStatus('Sync paths configuration coming soon...', 'success');
        }
        
        async function syncCompleteBackup() {
            showStatus('Starting complete backup...', 'success');
            
            try {
                const result = await window.api.syncGSXCompleteBackup();
                if (result.success) {
                    // Build detailed success message
                    const summary = result.result.summary;
                    const results = result.result.results;
                    
                    let message = `‚úÖ Backup completed in ${summary.durationFormatted}\n\n`;
                    message += `üìä Summary:\n`;
                    message += `‚Ä¢ Total Files: ${summary.totalFiles}\n`;
                    message += `‚Ä¢ Total Size: ${summary.totalSizeFormatted}\n`;
                    message += `‚Ä¢ Environment: ${summary.environment}\n\n`;
                    message += `üìÅ What was backed up:\n\n`;
                    
                    results.forEach(r => {
                        message += `${r.name}:\n`;
                        message += `  ‚Ä¢ Files: ${r.fileCount || 0}\n`;
                        message += `  ‚Ä¢ Size: ${r.totalSizeFormatted || '0 Bytes'}\n`;
                        message += `  ‚Ä¢ Duration: ${r.durationFormatted || '0s'}\n`;
                        message += `  ‚Ä¢ Location: GSX Files/${r.remotePath}\n\n`;
                    });
                    
                    // Show detailed modal
                    alert(message);
                    showStatus(`‚úÖ Backup complete! ${summary.totalFiles} files (${summary.totalSizeFormatted}) backed up in ${summary.durationFormatted}`, 'success');
                } else {
                    showStatus(`Backup failed: ${result.error}`, 'error');
                }
            } catch (error) {
                showStatus(`Error during backup: ${error.message}`, 'error');
            }
        }
        
        async function syncNow() {
            showStatus('Starting sync...', 'success');
            
            try {
                const result = await window.api.syncGSXNow();
                if (result.success) {
                    showStatus('Files synced successfully!', 'success');
                } else {
                    showStatus(`Sync failed: ${result.error}`, 'error');
                }
            } catch (error) {
                showStatus(`Error syncing: ${error.message}`, 'error');
            }
        }
        
        async function pasteGSXToken() {
            try {
                // Read from clipboard
                const clipboardText = await navigator.clipboard.readText();
                
                if (!clipboardText) {
                    showStatus('Clipboard is empty', 'error');
                    return;
                }
                
                // Basic validation - check if it looks like a token
                if (clipboardText.length < 20) {
                    showStatus('Invalid token format in clipboard', 'error');
                    return;
                }
                
                // Set the token value
                document.getElementById('gsxToken').value = clipboardText.trim();
                
                // Show success message
                showStatus('Token pasted from clipboard', 'success');
                
                // Optionally auto-test the connection
                setTimeout(() => {
                    testGSXConnection();
                }, 500);
            } catch (error) {
                console.error('Failed to read clipboard:', error);
                showStatus('Failed to read clipboard. Please paste manually with Ctrl+V or Cmd+V', 'error');
            }
        }
        
        async function refreshGSXToken() {
            const statusEl = document.getElementById('gsxTokenStatus');
            statusEl.textContent = '(Refreshing...)';
            statusEl.className = 'api-key-status';
            
            try {
                showStatus('Refreshing GSX token...', 'info');
                const result = await window.electronAPI.refreshGSXToken();
                
                if (result.success) {
                    // Update the token field with the new token
                    if (result.token) {
                        document.getElementById('gsxToken').value = result.token;
                    }
                    statusEl.textContent = '(Token refreshed!)';
                    statusEl.className = 'api-key-status status-valid';
                    showStatus('GSX token refreshed successfully!', 'success');
                } else {
                    statusEl.textContent = '(Refresh failed)';
                    statusEl.className = 'api-key-status status-invalid';
                    showStatus('Token refresh failed: ' + (result.error || 'Unknown error'), 'error');
                }
            } catch (error) {
                statusEl.textContent = '(Refresh failed)';
                statusEl.className = 'api-key-status status-invalid';
                showStatus('Token refresh error: ' + error.message, 'error');
            }
        }

        function clearGSXToken() {
            if (confirm('Are you sure you want to clear the GSX token?')) {
                document.getElementById('gsxToken').value = '';
                document.getElementById('gsxTokenStatus').textContent = '';
                document.getElementById('gsxTokenStatus').className = 'api-key-status';
                showStatus('GSX token cleared', 'success');
            }
        }
    </script>
</body>
</html> 
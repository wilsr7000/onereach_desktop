<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Settings</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: #1e1e1e;
            color: #e0e0e0;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }
        
        .header {
            background-color: #2d2d2d;
            padding: 20px;
            border-bottom: 1px solid #3e3e3e;
        }
        
        h1 {
            font-size: 24px;
            font-weight: 500;
        }
        
        .container {
            flex: 1;
            padding: 30px;
            max-width: 800px;
            margin: 0 auto;
            width: 100%;
        }
        
        .section {
            background-color: #2d2d2d;
            border-radius: 8px;
            padding: 24px;
            margin-bottom: 20px;
        }
        
        .section-title {
            font-size: 18px;
            font-weight: 500;
            margin-bottom: 20px;
            color: #fff;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-size: 14px;
            color: #b0b0b0;
        }
        
        input[type="text"],
        input[type="password"],
        select {
            width: 100%;
            padding: 10px 12px;
            background-color: #1e1e1e;
            border: 1px solid #3e3e3e;
            border-radius: 6px;
            color: #e0e0e0;
            font-size: 14px;
            transition: border-color 0.2s;
        }
        
        input[type="text"]:focus,
        input[type="password"]:focus,
        select:focus {
            outline: none;
            border-color: #0e639c;
        }
        
        .api-key-group {
            position: relative;
        }
        
        .toggle-visibility {
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: #b0b0b0;
            cursor: pointer;
            padding: 5px;
            font-size: 16px;
        }
        
        .toggle-visibility:hover {
            color: #e0e0e0;
        }
        
        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }
        
        .info-text {
            font-size: 12px;
            color: #888;
            margin-top: 5px;
        }
        
        .button-group {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
            margin-top: 30px;
        }
        
        button {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .btn-primary {
            background-color: #0e639c;
            color: white;
        }
        
        .btn-primary:hover {
            background-color: #1177bb;
        }
        
        .btn-secondary {
            background-color: #3e3e3e;
            color: #e0e0e0;
        }
        
        .btn-secondary:hover {
            background-color: #4e4e4e;
        }
        
        .status-message {
            padding: 12px;
            border-radius: 6px;
            margin-bottom: 20px;
            display: none;
        }
        
        .status-success {
            background-color: rgba(0, 200, 83, 0.1);
            border: 1px solid rgba(0, 200, 83, 0.3);
            color: #00c853;
        }
        
        .status-error {
            background-color: rgba(244, 67, 54, 0.1);
            border: 1px solid rgba(244, 67, 54, 0.3);
            color: #f44336;
        }
        
        .test-connection {
            display: inline-block;
            margin-left: 10px;
            font-size: 12px;
            color: #0e639c;
            cursor: pointer;
            text-decoration: none;
        }
        
        .test-connection:hover {
            text-decoration: underline;
        }
        
        .api-key-status {
            display: inline-block;
            margin-left: 10px;
            font-size: 12px;
        }
        
        .status-valid {
            color: #00c853;
        }
        
        .status-invalid {
            color: #f44336;
        }
        
        .divider {
            height: 1px;
            background-color: #3e3e3e;
            margin: 30px 0;
        }
        
        /* API Keys Card Grid */
        .api-keys-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 16px;
            margin-top: 16px;
        }
        
        .api-key-card {
            background: #252525;
            border: 1px solid #3e3e3e;
            border-radius: 8px;
            padding: 16px;
            transition: border-color 0.2s;
        }
        
        .api-key-card:hover {
            border-color: #4e4e4e;
        }
        
        .api-key-card.configured {
            border-color: rgba(0, 200, 83, 0.3);
        }
        
        .api-key-card-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 12px;
        }
        
        .api-key-card-title {
            font-size: 14px;
            font-weight: 500;
            color: #fff;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .api-key-card-badge {
            font-size: 10px;
            padding: 2px 6px;
            border-radius: 4px;
            font-weight: 500;
            text-transform: uppercase;
        }
        
        .badge-required {
            background: rgba(139, 92, 246, 0.2);
            color: #a78bfa;
        }
        
        .badge-optional {
            background: rgba(100, 100, 100, 0.3);
            color: #888;
        }
        
        .badge-configured {
            background: rgba(0, 200, 83, 0.15);
            color: #00c853;
        }
        
        .api-key-card-desc {
            font-size: 11px;
            color: #888;
            margin-bottom: 12px;
            line-height: 1.4;
        }
        
        .api-key-card-input {
            position: relative;
        }
        
        .api-key-card-input input {
            width: 100%;
            padding: 8px 36px 8px 10px;
            font-size: 13px;
        }
        
        .api-key-card-input .toggle-visibility {
            position: absolute;
            right: 4px;
            top: 50%;
            transform: translateY(-50%);
            padding: 4px;
            font-size: 14px;
        }
        
        .api-key-card-link {
            display: block;
            margin-top: 8px;
            font-size: 11px;
            color: #8b5cf6;
            text-decoration: none;
        }
        
        .api-key-card-link:hover {
            text-decoration: underline;
        }
        
        .section-subtitle {
            font-size: 13px;
            color: #888;
            margin-bottom: 16px;
            font-weight: normal;
        }
        
        .api-section-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 8px;
        }
        
        .api-section-header h3 {
            font-size: 14px;
            font-weight: 500;
            color: #b0b0b0;
            margin: 0;
        }
        
        .api-section-line {
            flex: 1;
            height: 1px;
            background: #3e3e3e;
        }
        
        /* Dark scrollbar styling */
        ::-webkit-scrollbar {
            width: 12px;
            height: 12px;
        }
        
        ::-webkit-scrollbar-track {
            background-color: #1e1e1e;
            border-radius: 6px;
        }
        
        ::-webkit-scrollbar-thumb {
            background-color: #3e3e3e;
            border-radius: 6px;
            border: 2px solid #1e1e1e;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background-color: #4e4e4e;
        }
        
        ::-webkit-scrollbar-thumb:active {
            background-color: #5e5e5e;
        }
        
        /* Make scrollbar corners match */
        ::-webkit-scrollbar-corner {
            background-color: #1e1e1e;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>Settings</h1>
    </div>
    
    <div class="container">
        <div id="statusMessage" class="status-message"></div>
        
        <!-- API Keys Section -->
        <div class="section">
            <h2 class="section-title">API Keys</h2>
            <p class="section-subtitle">All keys are encrypted and stored securely using your system's keychain</p>
            
            <!-- Core AI Keys -->
            <div class="api-section-header">
                <h3>Core AI Services</h3>
                <div class="api-section-line"></div>
            </div>
            
            <div class="api-keys-grid">
                <!-- OpenAI -->
                <div class="api-key-card" id="openaiCard">
                    <div class="api-key-card-header">
                        <span class="api-key-card-title">
                            OpenAI
                            <span class="api-key-card-badge badge-required">Required</span>
                        </span>
                        <span id="openaiKeyStatus" class="api-key-status"></span>
                    </div>
                    <div class="api-key-card-desc">Voice Orb, Image Editing, Whisper Transcription, GPT Models</div>
                    <div class="api-key-card-input">
                        <input type="password" id="openaiApiKey" placeholder="sk-proj-...">
                        <button class="toggle-visibility" onclick="toggleOpenAIKeyVisibility()">Show</button>
                    </div>
                    <a href="https://platform.openai.com/api-keys" target="_blank" class="api-key-card-link">Get API Key</a>
                </div>
                
                <!-- Anthropic -->
                <div class="api-key-card" id="anthropicCard">
                    <div class="api-key-card-header">
                        <span class="api-key-card-title">
                            Anthropic (Claude)
                            <span class="api-key-card-badge badge-required">Required</span>
                        </span>
                        <span id="anthropicKeyStatus" class="api-key-status"></span>
                    </div>
                    <div class="api-key-card-desc">Agent Composer, AI Analysis, Claude Models</div>
                    <div class="api-key-card-input">
                        <input type="password" id="anthropicApiKey" placeholder="sk-ant-...">
                        <button class="toggle-visibility" onclick="toggleAnthropicKeyVisibility()">Show</button>
                    </div>
                    <a href="https://console.anthropic.com/settings/keys" target="_blank" class="api-key-card-link">Get API Key</a>
                </div>
            </div>
            
            <!-- Speech & Voice Keys -->
            <div class="api-section-header" style="margin-top: 24px;">
                <h3>Speech & Voice</h3>
                <div class="api-section-line"></div>
            </div>
            
            <div class="api-keys-grid">
                <!-- AssemblyAI -->
                <div class="api-key-card" id="assemblyaiCard">
                    <div class="api-key-card-header">
                        <span class="api-key-card-title">
                            AssemblyAI
                            <span class="api-key-card-badge badge-optional">Optional</span>
                        </span>
                        <span id="assemblyaiKeyStatus" class="api-key-status"></span>
                    </div>
                    <div class="api-key-card-desc">Speaker Recognition, Advanced Transcription</div>
                    <div class="api-key-card-input">
                        <input type="password" id="assemblyaiApiKey" placeholder="Enter API key">
                        <button class="toggle-visibility" onclick="toggleAssemblyAIKeyVisibility()">Show</button>
                    </div>
                    <a href="https://www.assemblyai.com/app" target="_blank" class="api-key-card-link">Get API Key</a>
                </div>
                
                <!-- ElevenLabs -->
                <div class="api-key-card" id="elevenLabsCard">
                    <div class="api-key-card-header">
                        <span class="api-key-card-title">
                            ElevenLabs
                            <span class="api-key-card-badge badge-optional">Optional</span>
                        </span>
                        <span id="elevenLabsKeyStatus" class="api-key-status"></span>
                    </div>
                    <div class="api-key-card-desc">AI Voice Generation, Audio Replacement</div>
                    <div class="api-key-card-input">
                        <input type="password" id="elevenLabsApiKey" placeholder="Enter API key">
                        <button class="toggle-visibility" onclick="toggleElevenLabsKeyVisibility()">Show</button>
                    </div>
                    <a href="https://elevenlabs.io/app/settings/api-keys" target="_blank" class="api-key-card-link">Get API Key</a>
                </div>
            </div>
            
            <!-- Video Platform Keys -->
            <div class="api-section-header" style="margin-top: 24px;">
                <h3>Video Platforms</h3>
                <div class="api-section-line"></div>
            </div>
            
            <div class="api-keys-grid">
                <!-- YouTube -->
                <div class="api-key-card" id="youtubeCard">
                    <div class="api-key-card-header">
                        <span class="api-key-card-title">
                            YouTube
                            <span class="api-key-card-badge badge-optional">Optional</span>
                        </span>
                        <span id="youtubeConnectionStatus" class="api-key-status"></span>
                    </div>
                    <div class="api-key-card-desc">Direct uploads to YouTube</div>
                    <div class="api-key-card-input" style="margin-bottom: 8px;">
                        <input type="text" id="youtubeClientId" placeholder="Client ID">
                    </div>
                    <div class="api-key-card-input">
                        <input type="password" id="youtubeClientSecret" placeholder="Client Secret">
                        <button class="toggle-visibility" onclick="toggleYouTubeSecretVisibility()">Show</button>
                    </div>
                    <button id="youtubeConnectBtn" onclick="connectYouTube()" style="margin-top: 10px; width: 100%; background: #3e3e3e; color: #e0e0e0; border: none; padding: 8px; border-radius: 4px; cursor: pointer; font-size: 12px;">
                        Connect YouTube
                    </button>
                    <a href="https://console.cloud.google.com/apis/credentials" target="_blank" class="api-key-card-link">Setup OAuth</a>
                </div>
                
                <!-- Vimeo -->
                <div class="api-key-card" id="vimeoCard">
                    <div class="api-key-card-header">
                        <span class="api-key-card-title">
                            Vimeo
                            <span class="api-key-card-badge badge-optional">Optional</span>
                        </span>
                    </div>
                    <div class="api-key-card-desc">Direct uploads to Vimeo</div>
                    <div class="api-key-card-input" style="margin-bottom: 8px;">
                        <input type="text" id="vimeoClientId" placeholder="Client ID">
                    </div>
                    <div class="api-key-card-input">
                        <input type="password" id="vimeoClientSecret" placeholder="Client Secret">
                        <button class="toggle-visibility" onclick="toggleVimeoSecretVisibility()">Show</button>
                    </div>
                    <a href="https://developer.vimeo.com/apps" target="_blank" class="api-key-card-link">Setup OAuth</a>
                </div>
            </div>
        </div>
        
        <!-- LLM Configuration Section -->
        <div class="section">
            <h2 class="section-title">LLM Configuration</h2>
            
            <div class="form-group">
                <label for="llmProvider">Default Provider</label>
                <select id="llmProvider">
                    <option value="openai">OpenAI</option>
                    <option value="anthropic">Anthropic (Claude)</option>
                    <option value="google">Google (Gemini)</option>
                    <option value="mistral">Mistral</option>
                    <option value="custom">Custom Endpoint</option>
                </select>
            </div>
            
            <div class="form-group">
                <label for="llmModel">Default Model</label>
                <select id="llmModel">
                    <option value="gpt-5.2">GPT-5.2 Thinking</option>
                    <option value="gpt-5.2-pro">GPT-5.2 Pro</option>
                    <option value="gpt-5.2-chat-latest">GPT-5.2 Instant</option>
                    <option value="claude-opus-4-5-20251101">Claude Opus 4.5</option>
                    <option value="claude-sonnet-4-5-20250929">Claude Sonnet 4.5</option>
                    <option value="gemini-pro">Gemini Pro</option>
                    <option value="gemini-1.5-pro">Gemini 1.5 Pro</option>
                    <option value="mistral-large">Mistral Large</option>
                    <option value="mistral-medium">Mistral Medium</option>
                    <option value="mistral-small">Mistral Small</option>
                </select>
            </div>
            
            <div class="form-group api-key-group">
                <label for="llmApiKey">
                    Provider API Key (Legacy)
                    <span id="apiKeyStatus" class="api-key-status"></span>
                    <a href="#" class="test-connection" onclick="testConnection()">Test</a>
                </label>
                <div style="position: relative;">
                    <input type="password" id="llmApiKey" placeholder="Use dedicated keys above instead">
                    <button class="toggle-visibility" onclick="toggleApiKeyVisibility()">Show</button>
                </div>
                <div class="info-text">For backwards compatibility. Prefer using the dedicated OpenAI/Anthropic keys above.</div>
            </div>
            
            <div class="form-group" id="claude4ThinkingGroup" style="display: none;">
                <label for="claude4ThinkingMode">Claude Thinking Mode</label>
                <select id="claude4ThinkingMode">
                    <option value="disabled">Disabled (Fast Response)</option>
                    <option value="enabled">Enabled (Extended Thinking)</option>
                </select>
                <div class="info-text">Enable extended thinking for complex reasoning</div>
            </div>
            
            <div class="form-group" id="claude4ThinkingLevelGroup" style="display: none;">
                <label for="claude4ThinkingLevel">Thinking Level</label>
                <select id="claude4ThinkingLevel">
                    <option value="default">Default</option>
                    <option value="think">Think (~4k tokens)</option>
                    <option value="think-hard">Think Hard (~10k tokens)</option>
                    <option value="ultrathink">Ultra Think (~32k tokens)</option>
                </select>
            </div>
            
            <div class="form-group" style="display: flex; align-items: center; gap: 12px;">
                <button class="btn" id="vimeoConnectBtn" onclick="connectVimeo()" style="background: #1ab7ea; color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer;">
                    üé¨ Connect Vimeo Account
                </button>
                <span id="vimeoConnectionStatus" style="font-size: 13px; color: #b0b0b0;"></span>
            </div>
            
            <div class="info-text">
                To enable direct Vimeo uploads:
                1. Go to <a href="https://developer.vimeo.com/apps" style="color: #8b5cf6;">Vimeo Developer Apps</a>
                2. Create a new app
                3. Add <code style="background: #1e1e1e; padding: 2px 6px; border-radius: 4px;">http://localhost:8090/oauth/callback</code> as redirect URI
                4. Request upload scope
            </div>
            
            <div class="divider"></div>
            
            <h3 style="font-size: 16px; margin-bottom: 16px;">AI Features</h3>
            
            <div class="form-group">
                <div class="checkbox-group">
                    <input type="checkbox" id="autoAIMetadata">
                    <label for="autoAIMetadata" style="margin-bottom: 0;">Auto-generate AI metadata for clipboard items</label>
                </div>
                <div class="info-text">Automatically analyze clipboard content and generate descriptions, tags, and notes using Claude Sonnet 4.5 (requires API key)</div>
            </div>
            
            <div class="form-group" id="autoAIMetadataTypesGroup" style="display: block;">
                <label>Content types to auto-analyze:</label>
                <div style="display: flex; flex-wrap: wrap; gap: 12px; margin-top: 8px;">
                    <label style="display: flex; align-items: center; gap: 6px; cursor: pointer;">
                        <input type="checkbox" id="aiTypeAll" value="all" style="width: 14px; height: 14px;" checked>
                        <span style="font-size: 13px;">All types</span>
                    </label>
                    <label style="display: flex; align-items: center; gap: 6px; cursor: pointer;">
                        <input type="checkbox" id="aiTypeImage" value="image" style="width: 14px; height: 14px;" checked disabled>
                        <span style="font-size: 13px;">Images</span>
                    </label>
                    <label style="display: flex; align-items: center; gap: 6px; cursor: pointer;">
                        <input type="checkbox" id="aiTypeScreenshot" value="screenshot" style="width: 14px; height: 14px;" checked disabled>
                        <span style="font-size: 13px;">Screenshots</span>
                    </label>
                    <label style="display: flex; align-items: center; gap: 6px; cursor: pointer;">
                        <input type="checkbox" id="aiTypeCode" value="code" style="width: 14px; height: 14px;" checked disabled>
                        <span style="font-size: 13px;">Code</span>
                    </label>
                    <label style="display: flex; align-items: center; gap: 6px; cursor: pointer;">
                        <input type="checkbox" id="aiTypeText" value="text" style="width: 14px; height: 14px;" checked disabled>
                        <span style="font-size: 13px;">Text</span>
                    </label>
                    <label style="display: flex; align-items: center; gap: 6px; cursor: pointer;">
                        <input type="checkbox" id="aiTypeHtml" value="html" style="width: 14px; height: 14px;" checked disabled>
                        <span style="font-size: 13px;">HTML</span>
                    </label>
                    <label style="display: flex; align-items: center; gap: 6px; cursor: pointer;">
                        <input type="checkbox" id="aiTypeFile" value="file" style="width: 14px; height: 14px;" checked disabled>
                        <span style="font-size: 13px;">Files</span>
                    </label>
                </div>
                <div class="info-text" style="margin-top: 8px;">Select which types of content should be automatically analyzed when captured</div>
            </div>
            
            <div class="form-group">
                <div class="checkbox-group">
                    <input type="checkbox" id="autoGenerateScreenshotMetadata">
                    <label for="autoGenerateScreenshotMetadata" style="margin-bottom: 0;">Legacy: Auto-analyze screenshots only</label>
                </div>
                <div class="info-text">‚ö†Ô∏è Deprecated - use the new "Auto-generate AI metadata" option above instead</div>
            </div>
            
            <div class="divider"></div>
            
            <h3 style="font-size: 16px; margin-bottom: 16px;">Headless Claude (Free AI Calls)</h3>
            
            <div class="form-group">
                <div class="checkbox-group">
                    <input type="checkbox" id="claudePreferHeadless" checked>
                    <label for="claudePreferHeadless" style="margin-bottom: 0;">Prefer headless Claude (free, uses web login)</label>
                </div>
                <div class="info-text">When enabled, AI operations will first try using your Claude web session (free), falling back to API only if needed. Requires being logged into claude.ai.</div>
            </div>
            
            <div class="form-group">
                <label for="claudeHeadlessTimeout">Headless Timeout (seconds)</label>
                <select id="claudeHeadlessTimeout">
                    <option value="30000">30 seconds</option>
                    <option value="60000" selected>60 seconds (default)</option>
                    <option value="90000">90 seconds</option>
                    <option value="120000">120 seconds</option>
                </select>
                <div class="info-text">How long to wait for headless Claude before falling back to API</div>
            </div>
            
            <div class="form-group">
                <div class="checkbox-group">
                    <input type="checkbox" id="claudeApiFallback" checked>
                    <label for="claudeApiFallback" style="margin-bottom: 0;">Enable API fallback</label>
                </div>
                <div class="info-text">If headless fails (not logged in, timeout), automatically fall back to the Claude API (requires API key, has cost)</div>
            </div>
        </div>
        
        <div class="section">
            <h2 class="section-title">GSX File Sync Configuration</h2>
            
            <div class="form-group">
                <label for="gsxEnvironment">GSX Environment</label>
                <select id="gsxEnvironment" onchange="console.log('Environment changed to:', this.value)">
                    <option value="production">Production</option>
                    <option value="edison">Edison</option>
                    <option value="staging">Staging</option>
                    <option value="qa">QA</option>
                </select>
                <div class="info-text">Select the environment where you obtained your token</div>
            </div>
            
            <div class="form-group api-key-group">
                <label for="gsxToken">
                    GSX Token
                    <span id="gsxTokenStatus" class="api-key-status"></span>
                    <a href="#" class="test-connection" onclick="testGSXConnection()">Test Connection</a>
                </label>
                <div style="position: relative;">
                    <input type="password" id="gsxToken" placeholder="Paste your OneReach GSX token here">
                    <button class="toggle-visibility" onclick="toggleGSXTokenVisibility()">üëÅ</button>
                </div>
                <div style="margin-top: 10px;">
                    <button class="btn-secondary" onclick="pasteGSXToken()" style="padding: 6px 12px; font-size: 12px;">
                        üìã Paste Token from Clipboard
                    </button>
                    <button class="btn-secondary" onclick="refreshGSXToken()" style="padding: 6px 12px; font-size: 12px; margin-left: 10px;">
                        üîÑ Refresh Token
                    </button>
                    <button class="btn-secondary" onclick="clearGSXToken()" style="padding: 6px 12px; font-size: 12px; margin-left: 10px;">
                        üóëÔ∏è Clear Token
                    </button>
                </div>
                <div class="info-text">
                    <strong>How to get your token:</strong> Log into OneReach ‚Üí Account Settings ‚Üí API Tokens ‚Üí Generate New Token<br>
                    Your token is encrypted and stored securely in your system keychain
                </div>
            </div>
            
            <div class="form-group">
                <label for="gsxAccountId">
                    GSX Account ID (Optional)
                </label>
                <input type="text" id="gsxAccountId" placeholder="e.g. 05bd3c92-5d3c-4dc5-a95d-0c584695cea4">
                <div class="info-text">
                    Your account ID from GSX (optional - found in user preferences or URL)
                </div>
            </div>
            
            <div class="divider"></div>
            
            <h3 style="font-size: 16px; margin-bottom: 16px;">Auto-Sync Settings</h3>
            
            <div class="form-group">
                <div class="checkbox-group">
                    <input type="checkbox" id="gsxAutoSync">
                    <label for="gsxAutoSync" style="margin-bottom: 0;">Enable Auto-Sync</label>
                </div>
                <div class="info-text">Automatically sync configured directories to GSX Files</div>
            </div>
            
            <div class="form-group">
                <label for="gsxSyncInterval">Sync Interval</label>
                <select id="gsxSyncInterval">
                    <option value="hourly">Hourly</option>
                    <option value="daily">Daily</option>
                    <option value="weekly">Weekly</option>
                    <option value="manual">Manual Only</option>
                </select>
                <div class="info-text">How often to automatically sync files to GSX</div>
            </div>
            
            <div class="form-group">
                <button class="btn-primary" onclick="syncCompleteBackup()" style="padding: 12px 24px;">
                    üîí Complete Backup (Recommended)
                </button>
                <button class="btn-secondary" onclick="syncNow()" style="margin-left: 10px;">Quick Sync</button>
                <div class="info-text">
                    <strong>Complete Backup</strong> syncs everything needed to restore on a new machine:<br>
                    ‚Ä¢ OR-Spaces (clipboard data, items, spaces)<br>
                    ‚Ä¢ App Configuration (settings, IDW entries, GSX links)<br>
                    ‚Ä¢ Reading logs and preferences
                </div>
            </div>
        </div>
        
        <div class="section">
            <h2 class="section-title">General Settings</h2>
            
            <div class="form-group">
                <label for="theme">Theme</label>
                <select id="theme">
                    <option value="dark">Dark</option>
                    <option value="light">Light</option>
                    <option value="system">System</option>
                </select>
            </div>
            
            <div class="form-group">
                <div class="checkbox-group">
                    <input type="checkbox" id="autoSave">
                    <label for="autoSave" style="margin-bottom: 0;">Enable Auto-Save</label>
                </div>
                <div class="info-text">Automatically save settings when changed</div>
            </div>
            
            <div class="form-group">
                <div class="checkbox-group">
                    <input type="checkbox" id="spacesUploadIntegration">
                    <label for="spacesUploadIntegration" style="margin-bottom: 0;">Spaces Upload Integration</label>
                </div>
                <div class="info-text">Show "Choose from Spaces" option when uploading files throughout the app. Provides quick access to your Spaces content in file pickers.</div>
            </div>
            
            <div class="form-group">
                <div class="checkbox-group">
                    <input type="checkbox" id="voiceOrbEnabled">
                    <label for="voiceOrbEnabled" style="margin-bottom: 0;">Enable Voice Orb</label>
                </div>
                <div class="info-text">Show a floating voice orb for quick voice commands. Toggle visibility with Cmd+Shift+O (Mac) or Ctrl+Shift+O (Windows).</div>
            </div>
        </div>
        
        <div class="section">
            <h2 class="section-title">Learning API Settings</h2>
            
            <div class="form-group">
                <label for="learningApiUrl">Quick Starts API URL</label>
                <div style="display: flex; gap: 10px;">
                    <input type="text" id="learningApiUrl" placeholder="https://em.staging.api.onereach.ai/http/..." style="flex: 1;">
                    <button class="btn-secondary" onclick="testLearningApi()" style="min-width: 100px;">Test API</button>
                </div>
                <div class="info-text">API endpoint for Quick Starts tutorials content</div>
                <div id="learningApiStatus" class="api-key-status" style="display: none; margin-top: 5px;"></div>
            </div>
            
            <div class="form-group">
                <label for="learningApiMethod">API Method</label>
                <select id="learningApiMethod">
                    <option value="POST">POST</option>
                    <option value="GET">GET</option>
                </select>
                <div class="info-text">HTTP method for the API request (usually POST)</div>
            </div>
            
            <div class="form-group">
                <div class="checkbox-group">
                    <input type="checkbox" id="learningApiCache">
                    <label for="learningApiCache" style="margin-bottom: 0;">Enable Response Caching</label>
                </div>
                <div class="info-text">Cache API responses for 5 minutes to improve performance</div>
            </div>
        </div>
        
        <!-- Voice Context Providers Section -->
        <div class="section">
            <h2 class="section-title">Voice Context Providers</h2>
            <div class="info-text" style="margin-bottom: 20px;">
                Context providers enrich voice commands with additional information like time, location, and custom facts. This helps the AI understand your requests better.
            </div>
            
            <div id="contextProvidersContainer">
                <!-- Time/Date Provider -->
                <div class="form-group provider-group" data-provider-id="temporal">
                    <div class="checkbox-group">
                        <input type="checkbox" id="providerTemporal" checked>
                        <label for="providerTemporal" style="margin-bottom: 0;">Time & Date</label>
                    </div>
                    <div class="info-text">Provides current time, date, day of week, and part of day (morning/afternoon/evening)</div>
                </div>
                
                <!-- Active App Provider -->
                <div class="form-group provider-group" data-provider-id="active-app">
                    <div class="checkbox-group">
                        <input type="checkbox" id="providerActiveApp" checked>
                        <label for="providerActiveApp" style="margin-bottom: 0;">Active Application</label>
                    </div>
                    <div class="info-text">Detects the currently focused application and document you're working on</div>
                </div>
                
                <!-- Custom Facts Provider -->
                <div class="form-group provider-group" data-provider-id="custom-facts">
                    <div class="checkbox-group">
                        <input type="checkbox" id="providerCustomFacts" checked>
                        <label for="providerCustomFacts" style="margin-bottom: 0;">Custom Facts</label>
                    </div>
                    <div class="info-text">User-defined facts and preferences for personalized context</div>
                    
                    <div id="customFactsEditor" style="margin-top: 15px; padding-left: 24px;">
                        <div id="factsList" style="margin-bottom: 10px;"></div>
                        <div style="display: flex; gap: 10px; align-items: center;">
                            <input type="text" id="newFactKey" placeholder="Key (e.g., project_name)" style="flex: 1;">
                            <input type="text" id="newFactValue" placeholder="Value" style="flex: 2;">
                            <button class="btn-secondary" onclick="addCustomFact()" style="min-width: 60px;">Add</button>
                        </div>
                    </div>
                </div>
                
                <!-- Calendar Provider -->
                <div class="form-group provider-group" data-provider-id="calendar">
                    <div class="checkbox-group">
                        <input type="checkbox" id="providerCalendar">
                        <label for="providerCalendar" style="margin-bottom: 0;">Calendar (requires configuration)</label>
                    </div>
                    <div class="info-text">Shows current and upcoming meetings from your calendar</div>
                    <div id="calendarSettings" style="display: none; margin-top: 15px; padding-left: 24px;">
                        <label for="calendarSource" style="font-size: 12px;">Calendar Source</label>
                        <select id="calendarSource" style="margin-bottom: 10px;">
                            <option value="system">System Calendar (macOS)</option>
                            <option value="google">Google Calendar</option>
                            <option value="ical">iCal URL</option>
                        </select>
                    </div>
                </div>
                
                <!-- Location Provider -->
                <div class="form-group provider-group" data-provider-id="location">
                    <div class="checkbox-group">
                        <input type="checkbox" id="providerLocation">
                        <label for="providerLocation" style="margin-bottom: 0;">Location (requires permission)</label>
                    </div>
                    <div class="info-text">Provides city, region, and timezone. Uses IP geolocation by default.</div>
                </div>
            </div>
            
            <!-- Conversation History -->
            <div class="form-group" style="margin-top: 20px; padding-top: 20px; border-top: 1px solid #3e3e3e;">
                <label style="color: #fff; font-size: 16px; margin-bottom: 15px;">Conversation History</label>
                <div class="info-text" style="margin-bottom: 10px;">
                    Conversation history helps the AI understand context from previous voice commands.
                </div>
                <button class="btn-secondary" onclick="clearConversationHistory()" style="background: rgba(239, 68, 68, 0.1); border-color: rgba(239, 68, 68, 0.3); color: #fca5a5;">
                    Clear Conversation History
                </button>
            </div>
        </div>
        
        <div class="button-group">
            <button class="btn-secondary" onclick="window.close()">Cancel</button>
            <button class="btn-primary" onclick="saveSettings()">Save Settings</button>
        </div>
    </div>
    
    <script>
        let settings = {};
        let apiKeyVisible = false;
        let openaiKeyVisible = false;
        let anthropicKeyVisible = false;
        let assemblyaiKeyVisible = false;
        let elevenLabsKeyVisible = false;
        let gsxTokenVisible = false;
        let youtubeSecretVisible = false;
        let vimeoSecretVisible = false;
        
        // Load settings when window opens
        window.addEventListener('DOMContentLoaded', async () => {
            await loadSettings();
        });
        
        async function loadSettings() {
            try {
                settings = await window.api.getSettings();
                
                // Populate form fields
                document.getElementById('llmProvider').value = settings.llmProvider || 'openai';
                document.getElementById('llmModel').value = settings.llmModel || 'gpt-5.2';
                document.getElementById('llmApiKey').value = settings.llmApiKey || '';
                document.getElementById('openaiApiKey').value = settings.openaiApiKey || '';
                document.getElementById('anthropicApiKey').value = settings.anthropicApiKey || '';
                document.getElementById('assemblyaiApiKey').value = settings.assemblyaiApiKey || '';
                document.getElementById('theme').value = settings.theme || 'dark';
                document.getElementById('autoSave').checked = settings.autoSave !== false;
                document.getElementById('spacesUploadIntegration').checked = settings.spacesUploadIntegration !== false; // Default true
                document.getElementById('voiceOrbEnabled').checked = settings.voiceOrbEnabled === true; // Default false
                document.getElementById('autoGenerateScreenshotMetadata').checked = settings.autoGenerateScreenshotMetadata === true;
                
                // Auto AI Metadata settings
                const autoAIEnabled = settings.autoAIMetadata !== false; // Default to true
                document.getElementById('autoAIMetadata').checked = autoAIEnabled;
                document.getElementById('autoAIMetadataTypesGroup').style.display = autoAIEnabled ? 'block' : 'none';
                
                // Load AI metadata types (default to 'all')
                const aiTypes = settings.autoAIMetadataTypes || ['all'];
                const isAllTypes = aiTypes.includes('all');
                
                document.getElementById('aiTypeAll').checked = isAllTypes;
                document.getElementById('aiTypeImage').checked = aiTypes.includes('image') || isAllTypes;
                document.getElementById('aiTypeScreenshot').checked = aiTypes.includes('screenshot') || isAllTypes;
                document.getElementById('aiTypeCode').checked = aiTypes.includes('code') || isAllTypes;
                document.getElementById('aiTypeText').checked = aiTypes.includes('text') || isAllTypes;
                document.getElementById('aiTypeHtml').checked = aiTypes.includes('html') || isAllTypes;
                document.getElementById('aiTypeFile').checked = aiTypes.includes('file') || isAllTypes;
                
                // Disable individual checkboxes when "All" is selected
                document.getElementById('aiTypeImage').disabled = isAllTypes;
                document.getElementById('aiTypeScreenshot').disabled = isAllTypes;
                document.getElementById('aiTypeCode').disabled = isAllTypes;
                document.getElementById('aiTypeText').disabled = isAllTypes;
                document.getElementById('aiTypeHtml').disabled = isAllTypes;
                document.getElementById('aiTypeFile').disabled = isAllTypes;
                
                // GSX Settings
                document.getElementById('gsxToken').value = settings.gsxToken || '';
                document.getElementById('gsxEnvironment').value = settings.gsxEnvironment || 'production';
                document.getElementById('gsxAccountId').value = settings.gsxAccountId || '';
                document.getElementById('gsxAutoSync').checked = settings.gsxAutoSync === true;
                document.getElementById('gsxSyncInterval').value = settings.gsxSyncInterval || 'daily';
                
                // Learning API Settings
                document.getElementById('learningApiUrl').value = settings.learningApiUrl || 'https://em.staging.api.onereach.ai/http/48cc49ef-ab05-4d51-acc6-559c7ff22150/idw_quick_starts';
                document.getElementById('learningApiMethod').value = settings.learningApiMethod || 'POST';
                document.getElementById('learningApiCache').checked = settings.learningApiCache !== false;
                
                // Check if GSX token exists
                if (settings.gsxToken) {
                    document.getElementById('gsxTokenStatus').textContent = '(Token saved)';
                    document.getElementById('gsxTokenStatus').className = 'api-key-status status-valid';
                }
                
                // Update model options based on provider
                updateModelOptions();
                
                // Load Claude 4 thinking settings
                if (settings.claude4ThinkingMode) {
                    document.getElementById('claude4ThinkingMode').value = settings.claude4ThinkingMode;
                }
                if (settings.claude4ThinkingLevel) {
                    document.getElementById('claude4ThinkingLevel').value = settings.claude4ThinkingLevel;
                }
                
                // Show Claude 4 options if Claude 4 Opus is selected
                if (settings.llmModel === 'claude-opus-4-5-20251101') {
                    document.getElementById('claude4ThinkingGroup').style.display = 'block';
                    if (settings.claude4ThinkingMode === 'enabled') {
                        document.getElementById('claude4ThinkingLevelGroup').style.display = 'block';
                    }
                }
                
                // Check if API key exists
                if (settings.llmApiKey) {
                    document.getElementById('apiKeyStatus').textContent = '(Key saved)';
                    document.getElementById('apiKeyStatus').className = 'api-key-status status-valid';
                }
                
                // Check if OpenAI API key exists
                if (settings.openaiApiKey) {
                    document.getElementById('openaiKeyStatus').textContent = '(Key saved)';
                    document.getElementById('openaiKeyStatus').className = 'api-key-status status-valid';
                }
                
                // Check if Anthropic API key exists
                if (settings.anthropicApiKey) {
                    document.getElementById('anthropicKeyStatus').textContent = '(Key saved)';
                    document.getElementById('anthropicKeyStatus').className = 'api-key-status status-valid';
                }
                
                // Check if AssemblyAI API key exists
                if (settings.assemblyaiApiKey) {
                    document.getElementById('assemblyaiKeyStatus').textContent = '(Key saved)';
                    document.getElementById('assemblyaiKeyStatus').className = 'api-key-status status-valid';
                }
                
                // Load ElevenLabs API key
                document.getElementById('elevenLabsApiKey').value = settings.elevenLabsApiKey || '';

                // Check if ElevenLabs API key exists
                if (settings.elevenLabsApiKey) {
                    document.getElementById('elevenLabsKeyStatus').textContent = '(Key saved)';
                    document.getElementById('elevenLabsKeyStatus').className = 'api-key-status status-valid';
                }
                
                // Load YouTube credentials
                document.getElementById('youtubeClientId').value = settings.youtubeClientId || '';
                document.getElementById('youtubeClientSecret').value = settings.youtubeClientSecret || '';
                
                if (settings.youtubeClientId) {
                    document.getElementById('youtubeClientIdStatus').textContent = '(Saved)';
                    document.getElementById('youtubeClientIdStatus').className = 'api-key-status status-valid';
                }
                
                // Load Vimeo credentials
                document.getElementById('vimeoClientId').value = settings.vimeoClientId || '';
                document.getElementById('vimeoClientSecret').value = settings.vimeoClientSecret || '';
                
                if (settings.vimeoClientId) {
                    document.getElementById('vimeoClientIdStatus').textContent = '(Saved)';
                    document.getElementById('vimeoClientIdStatus').className = 'api-key-status status-valid';
                }
                
                // Check video release connections
                checkVideoReleaseConnections();
                
                // Load Claude headless settings
                document.getElementById('claudePreferHeadless').checked = settings.claudePreferHeadless !== false; // Default true
                document.getElementById('claudeHeadlessTimeout').value = settings.claudeHeadlessTimeout || '60000';
                document.getElementById('claudeApiFallback').checked = settings.claudeApiFallback !== false; // Default true
                
                // Update card status indicators
                updateApiKeyCardStatus();
                
                // Add input listeners for real-time card updates
                ['openaiApiKey', 'anthropicApiKey', 'assemblyaiApiKey', 'elevenLabsApiKey', 
                 'youtubeClientId', 'youtubeClientSecret', 'vimeoClientId', 'vimeoClientSecret'].forEach(id => {
                    const el = document.getElementById(id);
                    if (el) el.addEventListener('input', updateApiKeyCardStatus);
                });
            } catch (error) {
                console.error('Error loading settings:', error);
                showStatus('Error loading settings', 'error');
            }
        }
        
        async function saveSettings() {
            // Collect AI metadata types
            const aiMetadataTypes = [];
            if (document.getElementById('aiTypeAll').checked) {
                aiMetadataTypes.push('all');
            } else {
                if (document.getElementById('aiTypeImage').checked) aiMetadataTypes.push('image');
                if (document.getElementById('aiTypeScreenshot').checked) aiMetadataTypes.push('screenshot');
                if (document.getElementById('aiTypeCode').checked) aiMetadataTypes.push('code');
                if (document.getElementById('aiTypeText').checked) aiMetadataTypes.push('text');
                if (document.getElementById('aiTypeHtml').checked) aiMetadataTypes.push('html');
                if (document.getElementById('aiTypeFile').checked) aiMetadataTypes.push('file');
            }
            
            const newSettings = {
                llmProvider: document.getElementById('llmProvider').value,
                llmModel: document.getElementById('llmModel').value,
                llmApiKey: document.getElementById('llmApiKey').value,
                openaiApiKey: document.getElementById('openaiApiKey').value,
                anthropicApiKey: document.getElementById('anthropicApiKey').value,
                assemblyaiApiKey: document.getElementById('assemblyaiApiKey').value,
                elevenLabsApiKey: document.getElementById('elevenLabsApiKey').value,
                youtubeClientId: document.getElementById('youtubeClientId').value,
                youtubeClientSecret: document.getElementById('youtubeClientSecret').value,
                vimeoClientId: document.getElementById('vimeoClientId').value,
                vimeoClientSecret: document.getElementById('vimeoClientSecret').value,
                theme: document.getElementById('theme').value,
                autoSave: document.getElementById('autoSave').checked,
                spacesUploadIntegration: document.getElementById('spacesUploadIntegration').checked,
                voiceOrbEnabled: document.getElementById('voiceOrbEnabled').checked,
                claude4ThinkingMode: document.getElementById('claude4ThinkingMode').value,
                claude4ThinkingLevel: document.getElementById('claude4ThinkingLevel').value,
                autoGenerateScreenshotMetadata: document.getElementById('autoGenerateScreenshotMetadata').checked,
                autoAIMetadata: document.getElementById('autoAIMetadata').checked,
                autoAIMetadataTypes: aiMetadataTypes,
                gsxToken: document.getElementById('gsxToken').value,
                gsxEnvironment: document.getElementById('gsxEnvironment').value,
                gsxAccountId: document.getElementById('gsxAccountId').value,
                gsxAutoSync: document.getElementById('gsxAutoSync').checked,
                gsxSyncInterval: document.getElementById('gsxSyncInterval').value,
                learningApiUrl: document.getElementById('learningApiUrl').value,
                learningApiMethod: document.getElementById('learningApiMethod').value,
                learningApiCache: document.getElementById('learningApiCache').checked,
                // Claude headless settings
                claudePreferHeadless: document.getElementById('claudePreferHeadless').checked,
                claudeHeadlessTimeout: parseInt(document.getElementById('claudeHeadlessTimeout').value),
                claudeApiFallback: document.getElementById('claudeApiFallback').checked
            };
            
            try {
                const result = await window.api.saveSettings(newSettings);
                if (result) {
                    showStatus('Settings saved successfully', 'success');
                    setTimeout(() => {
                        window.close();
                    }, 1000);
                } else {
                    showStatus('Error saving settings', 'error');
                }
            } catch (error) {
                console.error('Error saving settings:', error);
                showStatus('Error saving settings', 'error');
            }
        }
        
        async function testLearningApi() {
            const url = document.getElementById('learningApiUrl').value;
            const method = document.getElementById('learningApiMethod').value;
            const statusDiv = document.getElementById('learningApiStatus');
            
            if (!url) {
                showApiStatus(statusDiv, 'Please enter an API URL', 'error');
                return;
            }
            
            showApiStatus(statusDiv, 'Testing API connection...', 'info');
            
            try {
                const response = await fetch(url, {
                    method: method,
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    },
                    body: method === 'POST' ? '{}' : undefined
                });
                
                if (response.ok) {
                    const data = await response.json();
                    if (data && data.user && data.categories) {
                        showApiStatus(statusDiv, `‚úÖ API working! Found ${Object.keys(data.categories).length} categories`, 'success');
                    } else {
                        showApiStatus(statusDiv, '‚ö†Ô∏è API responded but data format may be incorrect', 'warning');
                    }
                } else {
                    showApiStatus(statusDiv, `‚ùå API error: ${response.status} ${response.statusText}`, 'error');
                }
            } catch (error) {
                showApiStatus(statusDiv, `‚ùå Connection failed: ${error.message}`, 'error');
            }
        }
        
        function showApiStatus(element, message, type) {
            element.textContent = message;
            element.className = 'api-key-status';
            if (type === 'success') {
                element.className += ' status-valid';
            } else if (type === 'error') {
                element.className += ' status-invalid';
            }
            element.style.display = 'block';
        }
        
        function toggleApiKeyVisibility() {
            const input = document.getElementById('llmApiKey');
            const button = input.parentElement.querySelector('.toggle-visibility');
            
            if (apiKeyVisible) {
                input.type = 'password';
                button.textContent = 'Show';
                apiKeyVisible = false;
            } else {
                input.type = 'text';
                button.textContent = 'Hide';
                apiKeyVisible = true;
            }
        }
        
        function toggleOpenAIKeyVisibility() {
            const input = document.getElementById('openaiApiKey');
            const button = input.parentElement.querySelector('.toggle-visibility');
            
            if (openaiKeyVisible) {
                input.type = 'password';
                button.textContent = 'Show';
                openaiKeyVisible = false;
            } else {
                input.type = 'text';
                button.textContent = 'Hide';
                openaiKeyVisible = true;
            }
        }
        
        function toggleAnthropicKeyVisibility() {
            const input = document.getElementById('anthropicApiKey');
            const button = input.parentElement.querySelector('.toggle-visibility');
            
            if (anthropicKeyVisible) {
                input.type = 'password';
                button.textContent = 'Show';
                anthropicKeyVisible = false;
            } else {
                input.type = 'text';
                button.textContent = 'Hide';
                anthropicKeyVisible = true;
            }
        }
        
        function toggleAssemblyAIKeyVisibility() {
            const input = document.getElementById('assemblyaiApiKey');
            const button = input.parentElement.querySelector('.toggle-visibility');
            
            if (assemblyaiKeyVisible) {
                input.type = 'password';
                button.textContent = 'Show';
                assemblyaiKeyVisible = false;
            } else {
                input.type = 'text';
                button.textContent = 'Hide';
                assemblyaiKeyVisible = true;
            }
        }
        
        function toggleElevenLabsKeyVisibility() {
            const input = document.getElementById('elevenLabsApiKey');
            const button = input.parentElement.querySelector('.toggle-visibility');
            
            if (elevenLabsKeyVisible) {
                input.type = 'password';
                button.textContent = 'Show';
                elevenLabsKeyVisible = false;
            } else {
                input.type = 'text';
                button.textContent = 'Hide';
                elevenLabsKeyVisible = true;
            }
        }
        
        function toggleYouTubeSecretVisibility() {
            const input = document.getElementById('youtubeClientSecret');
            const button = input.parentElement.querySelector('.toggle-visibility');
            
            if (youtubeSecretVisible) {
                input.type = 'password';
                button.textContent = 'Show';
                youtubeSecretVisible = false;
            } else {
                input.type = 'text';
                button.textContent = 'Hide';
                youtubeSecretVisible = true;
            }
        }
        
        function toggleVimeoSecretVisibility() {
            const input = document.getElementById('vimeoClientSecret');
            const button = input.parentElement.querySelector('.toggle-visibility');
            
            if (vimeoSecretVisible) {
                input.type = 'password';
                button.textContent = 'Show';
                vimeoSecretVisible = false;
            } else {
                input.type = 'text';
                button.textContent = 'Hide';
                vimeoSecretVisible = true;
            }
        }
        
        // Update card styling based on configured state
        function updateApiKeyCardStatus() {
            const keys = [
                { id: 'openaiApiKey', card: 'openaiCard', status: 'openaiKeyStatus' },
                { id: 'anthropicApiKey', card: 'anthropicCard', status: 'anthropicKeyStatus' },
                { id: 'assemblyaiApiKey', card: 'assemblyaiCard', status: 'assemblyaiKeyStatus' },
                { id: 'elevenLabsApiKey', card: 'elevenLabsCard', status: 'elevenLabsKeyStatus' }
            ];
            
            keys.forEach(({ id, card, status }) => {
                const input = document.getElementById(id);
                const cardEl = document.getElementById(card);
                const statusEl = document.getElementById(status);
                
                if (input && cardEl) {
                    if (input.value && input.value.trim()) {
                        cardEl.classList.add('configured');
                        if (statusEl) {
                            statusEl.textContent = 'Configured';
                            statusEl.className = 'api-key-status status-valid';
                        }
                        // Update badge
                        const badge = cardEl.querySelector('.api-key-card-badge');
                        if (badge) {
                            badge.textContent = 'Configured';
                            badge.className = 'api-key-card-badge badge-configured';
                        }
                    } else {
                        cardEl.classList.remove('configured');
                        if (statusEl) {
                            statusEl.textContent = '';
                            statusEl.className = 'api-key-status';
                        }
                    }
                }
            });
            
            // Check YouTube
            const ytClientId = document.getElementById('youtubeClientId');
            const ytSecret = document.getElementById('youtubeClientSecret');
            const ytCard = document.getElementById('youtubeCard');
            if (ytClientId && ytSecret && ytCard) {
                if (ytClientId.value && ytSecret.value) {
                    ytCard.classList.add('configured');
                } else {
                    ytCard.classList.remove('configured');
                }
            }
            
            // Check Vimeo
            const vimeoClientId = document.getElementById('vimeoClientId');
            const vimeoSecret = document.getElementById('vimeoClientSecret');
            const vimeoCard = document.getElementById('vimeoCard');
            if (vimeoClientId && vimeoSecret && vimeoCard) {
                if (vimeoClientId.value && vimeoSecret.value) {
                    vimeoCard.classList.add('configured');
                } else {
                    vimeoCard.classList.remove('configured');
                }
            }
        }
        
        async function connectYouTube() {
            const clientId = document.getElementById('youtubeClientId').value;
            const clientSecret = document.getElementById('youtubeClientSecret').value;
            
            if (!clientId || !clientSecret) {
                showStatus('Please enter YouTube Client ID and Secret first', 'error');
                return;
            }
            
            document.getElementById('youtubeConnectionStatus').textContent = 'Connecting...';
            
            try {
                // First save the credentials
                await window.api.saveSettings({
                    youtubeClientId: clientId,
                    youtubeClientSecret: clientSecret
                });
                
                // Then initiate OAuth
                const result = await window.api.authenticateYouTube();
                
                if (result.success) {
                    const channelName = result.channel?.title || 'Connected';
                    document.getElementById('youtubeConnectionStatus').innerHTML = 
                        `<span style="color: #22c55e;">‚úì Connected as ${channelName}</span>`;
                    showStatus('YouTube connected successfully!', 'success');
                } else {
                    document.getElementById('youtubeConnectionStatus').innerHTML = 
                        `<span style="color: #ef4444;">‚úó ${result.error || 'Connection failed'}</span>`;
                }
            } catch (error) {
                document.getElementById('youtubeConnectionStatus').innerHTML = 
                    `<span style="color: #ef4444;">‚úó ${error.message}</span>`;
                showStatus('YouTube connection failed: ' + error.message, 'error');
            }
        }
        
        async function connectVimeo() {
            const clientId = document.getElementById('vimeoClientId').value;
            const clientSecret = document.getElementById('vimeoClientSecret').value;
            
            if (!clientId || !clientSecret) {
                showStatus('Please enter Vimeo Client ID and Secret first', 'error');
                return;
            }
            
            document.getElementById('vimeoConnectionStatus').textContent = 'Connecting...';
            
            try {
                // First save the credentials
                await window.api.saveSettings({
                    vimeoClientId: clientId,
                    vimeoClientSecret: clientSecret
                });
                
                // Then initiate OAuth
                const result = await window.api.authenticateVimeo();
                
                if (result.success) {
                    const userName = result.user?.name || 'Connected';
                    document.getElementById('vimeoConnectionStatus').innerHTML = 
                        `<span style="color: #22c55e;">‚úì Connected as ${userName}</span>`;
                    showStatus('Vimeo connected successfully!', 'success');
                } else {
                    document.getElementById('vimeoConnectionStatus').innerHTML = 
                        `<span style="color: #ef4444;">‚úó ${result.error || 'Connection failed'}</span>`;
                }
            } catch (error) {
                document.getElementById('vimeoConnectionStatus').innerHTML = 
                    `<span style="color: #ef4444;">‚úó ${error.message}</span>`;
                showStatus('Vimeo connection failed: ' + error.message, 'error');
            }
        }
        
        async function checkVideoReleaseConnections() {
            // Check YouTube connection
            try {
                const ytStatus = await window.api.getYouTubeStatus();
                if (ytStatus.authenticated) {
                    document.getElementById('youtubeConnectionStatus').innerHTML = 
                        `<span style="color: #22c55e;">‚úì Connected as ${ytStatus.channel?.title || 'Unknown'}</span>`;
                } else if (ytStatus.configured) {
                    document.getElementById('youtubeConnectionStatus').textContent = 'Not connected';
                }
            } catch (e) { /* ignore */ }
            
            // Check Vimeo connection
            try {
                const vimeoStatus = await window.api.getVimeoStatus();
                if (vimeoStatus.authenticated) {
                    document.getElementById('vimeoConnectionStatus').innerHTML = 
                        `<span style="color: #22c55e;">‚úì Connected as ${vimeoStatus.user?.name || 'Unknown'}</span>`;
                } else if (vimeoStatus.configured) {
                    document.getElementById('vimeoConnectionStatus').textContent = 'Not connected';
                }
            } catch (e) { /* ignore */ }
        }
        
        function updateModelOptions() {
            const provider = document.getElementById('llmProvider').value;
            const modelSelect = document.getElementById('llmModel');
            
            // Clear current options
            modelSelect.innerHTML = '';
            
            // Hide Claude 4 thinking options by default
            document.getElementById('claude4ThinkingGroup').style.display = 'none';
            document.getElementById('claude4ThinkingLevelGroup').style.display = 'none';
            
            // Add options based on provider
            let options = [];
            switch (provider) {
                case 'openai':
                    options = [
                        { value: 'gpt-5.2', text: 'GPT-5.2 Thinking' },
                        { value: 'gpt-5.2-pro', text: 'GPT-5.2 Pro' },
                        { value: 'gpt-5.2-chat-latest', text: 'GPT-5.2 Instant' }
                    ];
                    break;
                case 'anthropic':
                    options = [
                        { value: 'claude-opus-4-5-20251101', text: 'Claude Opus 4.5' },
                        { value: 'claude-sonnet-4-5-20250929', text: 'Claude Sonnet 4.5' }
                    ];
                    break;
                case 'google':
                    options = [
                        { value: 'gemini-1.5-pro', text: 'Gemini 1.5 Pro' },
                        { value: 'gemini-pro', text: 'Gemini Pro' },
                        { value: 'gemini-1.5-flash', text: 'Gemini 1.5 Flash' }
                    ];
                    break;
                case 'mistral':
                    options = [
                        { value: 'mistral-large', text: 'Mistral Large' },
                        { value: 'mistral-medium', text: 'Mistral Medium' },
                        { value: 'mistral-small', text: 'Mistral Small' }
                    ];
                    break;
                case 'custom':
                    options = [
                        { value: 'custom', text: 'Custom Model' }
                    ];
                    break;
            }
            
            options.forEach(opt => {
                const option = document.createElement('option');
                option.value = opt.value;
                option.textContent = opt.text;
                modelSelect.appendChild(option);
            });
        }
        
        async function testConnection() {
            const provider = document.getElementById('llmProvider').value;
            const apiKey = document.getElementById('llmApiKey').value;
            const model = document.getElementById('llmModel').value;
            
            if (!apiKey) {
                showStatus('Please enter an API key first', 'error');
                return;
            }
            
            showStatus('Testing connection...', 'success');
            
            try {
                const result = await window.api.testLLMConnection({ provider, apiKey, model });
                if (result.success) {
                    showStatus('Connection successful!', 'success');
                    document.getElementById('apiKeyStatus').textContent = '(Valid)';
                    document.getElementById('apiKeyStatus').className = 'api-key-status status-valid';
                } else {
                    showStatus(`Connection failed: ${result.error}`, 'error');
                    document.getElementById('apiKeyStatus').textContent = '(Invalid)';
                    document.getElementById('apiKeyStatus').className = 'api-key-status status-invalid';
                }
            } catch (error) {
                showStatus(`Error testing connection: ${error.message}`, 'error');
            }
        }
        
        function showStatus(message, type) {
            const statusEl = document.getElementById('statusMessage');
            statusEl.textContent = message;
            statusEl.className = `status-message status-${type}`;
            statusEl.style.display = 'block';
            
            // Auto-hide after 5 seconds
            setTimeout(() => {
                statusEl.style.display = 'none';
            }, 5000);
        }
        
        // Handle provider change
        document.getElementById('llmProvider').addEventListener('change', updateModelOptions);
        
        // Handle model change to show/hide Claude 4 options
        document.getElementById('llmModel').addEventListener('change', (e) => {
            const selectedModel = e.target.value;
            
            if (selectedModel === 'claude-opus-4-5-20251101') {
                document.getElementById('claude4ThinkingGroup').style.display = 'block';
                const thinkingMode = document.getElementById('claude4ThinkingMode').value;
                if (thinkingMode === 'enabled') {
                    document.getElementById('claude4ThinkingLevelGroup').style.display = 'block';
                }
            } else {
                document.getElementById('claude4ThinkingGroup').style.display = 'none';
                document.getElementById('claude4ThinkingLevelGroup').style.display = 'none';
            }
        });
        
        // Handle thinking mode change
        document.getElementById('claude4ThinkingMode').addEventListener('change', (e) => {
            if (e.target.value === 'enabled') {
                document.getElementById('claude4ThinkingLevelGroup').style.display = 'block';
            } else {
                document.getElementById('claude4ThinkingLevelGroup').style.display = 'none';
            }
        });
        
        // Auto-save if enabled
        document.getElementById('autoSave').addEventListener('change', (e) => {
            if (e.target.checked) {
                saveSettings();
            }
        });
        
        // Handle auto AI metadata toggle
        document.getElementById('autoAIMetadata').addEventListener('change', (e) => {
            document.getElementById('autoAIMetadataTypesGroup').style.display = e.target.checked ? 'block' : 'none';
        });
        
        // Handle "All types" checkbox - toggle all other checkboxes
        document.getElementById('aiTypeAll').addEventListener('change', (e) => {
            const checked = e.target.checked;
            document.getElementById('aiTypeImage').checked = checked;
            document.getElementById('aiTypeScreenshot').checked = checked;
            document.getElementById('aiTypeCode').checked = checked;
            document.getElementById('aiTypeText').checked = checked;
            document.getElementById('aiTypeHtml').checked = checked;
            document.getElementById('aiTypeFile').checked = checked;
            
            // Disable individual checkboxes when "All" is selected
            document.getElementById('aiTypeImage').disabled = checked;
            document.getElementById('aiTypeScreenshot').disabled = checked;
            document.getElementById('aiTypeCode').disabled = checked;
            document.getElementById('aiTypeText').disabled = checked;
            document.getElementById('aiTypeHtml').disabled = checked;
            document.getElementById('aiTypeFile').disabled = checked;
        });
        
        function toggleGSXTokenVisibility() {
            const input = document.getElementById('gsxToken');
            const button = event.target;
            
            if (gsxTokenVisible) {
                input.type = 'password';
                button.textContent = 'üëÅ';
                gsxTokenVisible = false;
            } else {
                input.type = 'text';
                button.textContent = 'üôà';
                gsxTokenVisible = true;
            }
        }
        
        async function testGSXConnection() {
            const token = document.getElementById('gsxToken').value;
            const environment = document.getElementById('gsxEnvironment').value;
            const accountId = document.getElementById('gsxAccountId').value;
            
            if (!token) {
                showStatus('Please enter a GSX token first', 'error');
                return;
            }
            
            console.log('Testing connection with:');
            console.log('- Environment:', environment);
            console.log('- Token length:', token.length);
            console.log('- Token starts:', token.substring(0, 20));
            console.log('- Token ends:', token.substring(token.length - 20));
            console.log('- Account ID:', accountId || 'not provided');
            
            showStatus('Testing GSX connection...', 'success');
            
            try {
                const result = await window.api.testGSXConnection({ token, environment, accountId });
                console.log('Test result:', result);
                
                if (result.success) {
                    showStatus('GSX connection successful!', 'success');
                    document.getElementById('gsxTokenStatus').textContent = '(Valid)';
                    document.getElementById('gsxTokenStatus').className = 'api-key-status status-valid';
                } else {
                    showStatus(`GSX connection failed: ${result.error}`, 'error');
                    document.getElementById('gsxTokenStatus').textContent = '(Invalid)';
                    document.getElementById('gsxTokenStatus').className = 'api-key-status status-invalid';
                }
            } catch (error) {
                showStatus(`Error testing GSX connection: ${error.message}`, 'error');
            }
        }
        
        async function configureSyncPaths() {
            // This would open a dialog to configure sync paths
            showStatus('Sync paths configuration coming soon...', 'success');
        }
        
        async function syncCompleteBackup() {
            showStatus('Starting complete backup...', 'success');
            
            try {
                const result = await window.api.syncGSXCompleteBackup();
                if (result.success) {
                    // Build detailed success message
                    const summary = result.result.summary;
                    const results = result.result.results;
                    
                    let message = `‚úÖ Backup completed in ${summary.durationFormatted}\n\n`;
                    message += `üìä Summary:\n`;
                    message += `‚Ä¢ Total Files: ${summary.totalFiles}\n`;
                    message += `‚Ä¢ Total Size: ${summary.totalSizeFormatted}\n`;
                    message += `‚Ä¢ Environment: ${summary.environment}\n\n`;
                    message += `üìÅ What was backed up:\n\n`;
                    
                    results.forEach(r => {
                        message += `${r.name}:\n`;
                        message += `  ‚Ä¢ Files: ${r.fileCount || 0}\n`;
                        message += `  ‚Ä¢ Size: ${r.totalSizeFormatted || '0 Bytes'}\n`;
                        message += `  ‚Ä¢ Duration: ${r.durationFormatted || '0s'}\n`;
                        message += `  ‚Ä¢ Location: GSX Files/${r.remotePath}\n\n`;
                    });
                    
                    // Show detailed modal
                    alert(message);
                    showStatus(`‚úÖ Backup complete! ${summary.totalFiles} files (${summary.totalSizeFormatted}) backed up in ${summary.durationFormatted}`, 'success');
                } else {
                    showStatus(`Backup failed: ${result.error}`, 'error');
                }
            } catch (error) {
                showStatus(`Error during backup: ${error.message}`, 'error');
            }
        }
        
        async function syncNow() {
            showStatus('Starting sync...', 'success');
            
            try {
                const result = await window.api.syncGSXNow();
                if (result.success) {
                    showStatus('Files synced successfully!', 'success');
                } else {
                    showStatus(`Sync failed: ${result.error}`, 'error');
                }
            } catch (error) {
                showStatus(`Error syncing: ${error.message}`, 'error');
            }
        }
        
        async function pasteGSXToken() {
            try {
                // Read from clipboard
                const clipboardText = await navigator.clipboard.readText();
                
                if (!clipboardText) {
                    showStatus('Clipboard is empty', 'error');
                    return;
                }
                
                // Basic validation - check if it looks like a token
                if (clipboardText.length < 20) {
                    showStatus('Invalid token format in clipboard', 'error');
                    return;
                }
                
                // Set the token value
                document.getElementById('gsxToken').value = clipboardText.trim();
                
                // Show success message
                showStatus('Token pasted from clipboard', 'success');
                
                // Optionally auto-test the connection
                setTimeout(() => {
                    testGSXConnection();
                }, 500);
            } catch (error) {
                console.error('Failed to read clipboard:', error);
                showStatus('Failed to read clipboard. Please paste manually with Ctrl+V or Cmd+V', 'error');
            }
        }
        
        async function refreshGSXToken() {
            const statusEl = document.getElementById('gsxTokenStatus');
            statusEl.textContent = '(Refreshing...)';
            statusEl.className = 'api-key-status';
            
            try {
                showStatus('Refreshing GSX token...', 'info');
                const result = await window.electronAPI.refreshGSXToken();
                
                if (result.success) {
                    // Update the token field with the new token
                    if (result.token) {
                        document.getElementById('gsxToken').value = result.token;
                    }
                    statusEl.textContent = '(Token refreshed!)';
                    statusEl.className = 'api-key-status status-valid';
                    showStatus('GSX token refreshed successfully!', 'success');
                } else {
                    statusEl.textContent = '(Refresh failed)';
                    statusEl.className = 'api-key-status status-invalid';
                    showStatus('Token refresh failed: ' + (result.error || 'Unknown error'), 'error');
                }
            } catch (error) {
                statusEl.textContent = '(Refresh failed)';
                statusEl.className = 'api-key-status status-invalid';
                showStatus('Token refresh error: ' + error.message, 'error');
            }
        }

        function clearGSXToken() {
            if (confirm('Are you sure you want to clear the GSX token?')) {
                document.getElementById('gsxToken').value = '';
                document.getElementById('gsxTokenStatus').textContent = '';
                document.getElementById('gsxTokenStatus').className = 'api-key-status';
                showStatus('GSX token cleared', 'success');
            }
        }
        
        // ==================== CONTEXT PROVIDERS ====================
        
        let customFacts = [];
        
        // Initialize context provider settings
        async function initContextProviders() {
            try {
                // Load provider states from settings
                const providerSettings = settings.contextProviders || {};
                
                document.getElementById('providerTemporal').checked = providerSettings.temporal !== false;
                document.getElementById('providerActiveApp').checked = providerSettings.activeApp !== false;
                document.getElementById('providerCustomFacts').checked = providerSettings.customFacts !== false;
                document.getElementById('providerCalendar').checked = providerSettings.calendar === true;
                document.getElementById('providerLocation').checked = providerSettings.location === true;
                
                // Load custom facts
                if (window.api && window.api.getCustomFacts) {
                    customFacts = await window.api.getCustomFacts() || [];
                } else {
                    customFacts = settings.customFacts || [];
                }
                renderCustomFacts();
                
                // Set up calendar settings visibility
                const calendarCheckbox = document.getElementById('providerCalendar');
                const calendarSettings = document.getElementById('calendarSettings');
                calendarCheckbox.addEventListener('change', () => {
                    calendarSettings.style.display = calendarCheckbox.checked ? 'block' : 'none';
                });
                
                // Add change handlers for providers
                document.querySelectorAll('.provider-group input[type="checkbox"]').forEach(checkbox => {
                    checkbox.addEventListener('change', saveProviderSettings);
                });
                
            } catch (e) {
                console.warn('Could not load context provider settings:', e);
            }
        }
        
        // Save provider settings
        async function saveProviderSettings() {
            const providerSettings = {
                temporal: document.getElementById('providerTemporal').checked,
                activeApp: document.getElementById('providerActiveApp').checked,
                customFacts: document.getElementById('providerCustomFacts').checked,
                calendar: document.getElementById('providerCalendar').checked,
                location: document.getElementById('providerLocation').checked,
                calendarSource: document.getElementById('calendarSource').value,
            };
            
            settings.contextProviders = providerSettings;
        }
        
        // Render custom facts list
        function renderCustomFacts() {
            const container = document.getElementById('factsList');
            
            if (customFacts.length === 0) {
                container.innerHTML = '<div style="color: #666; font-size: 12px; margin-bottom: 10px;">No custom facts defined. Add facts below.</div>';
                return;
            }
            
            container.innerHTML = customFacts.map((fact, index) => `
                <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 8px; padding: 8px; background: #1e1e1e; border-radius: 6px;">
                    <span style="flex: 1; font-size: 13px;"><strong style="color: #8888ff;">${escapeHtml(fact.key)}:</strong> ${escapeHtml(fact.value)}</span>
                    <button onclick="removeCustomFact(${index})" style="background: none; border: none; color: #888; cursor: pointer; padding: 4px;">√ó</button>
                </div>
            `).join('');
        }
        
        // Add a custom fact
        async function addCustomFact() {
            const keyInput = document.getElementById('newFactKey');
            const valueInput = document.getElementById('newFactValue');
            
            const key = keyInput.value.trim();
            const value = valueInput.value.trim();
            
            if (!key || !value) {
                showStatus('Please enter both key and value', 'error');
                return;
            }
            
            // Check for duplicate key
            const existing = customFacts.findIndex(f => f.key === key);
            if (existing >= 0) {
                customFacts[existing].value = value;
            } else {
                customFacts.push({ key, value });
            }
            
            // Save to API if available
            if (window.api && window.api.addCustomFact) {
                try {
                    await window.api.addCustomFact(key, value);
                } catch (e) {
                    console.warn('Could not save fact via API:', e);
                }
            }
            
            // Also save to settings
            settings.customFacts = customFacts;
            
            keyInput.value = '';
            valueInput.value = '';
            renderCustomFacts();
            showStatus('Custom fact added', 'success');
        }
        
        // Remove a custom fact
        async function removeCustomFact(index) {
            const fact = customFacts[index];
            if (!fact) return;
            
            customFacts.splice(index, 1);
            
            // Remove via API if available
            if (window.api && window.api.removeCustomFact) {
                try {
                    await window.api.removeCustomFact(fact.key);
                } catch (e) {
                    console.warn('Could not remove fact via API:', e);
                }
            }
            
            settings.customFacts = customFacts;
            renderCustomFacts();
        }
        
        // Clear conversation history
        async function clearConversationHistory() {
            if (!confirm('Are you sure you want to clear your voice conversation history?')) {
                return;
            }
            
            try {
                if (window.api && window.api.clearConversationHistory) {
                    await window.api.clearConversationHistory();
                }
                showStatus('Conversation history cleared', 'success');
            } catch (e) {
                showStatus('Failed to clear history: ' + e.message, 'error');
            }
        }
        
        // Escape HTML helper
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
        
        // Call initContextProviders after loadSettings
        const originalLoadSettings = loadSettings;
        loadSettings = async function() {
            await originalLoadSettings.call(this);
            await initContextProviders();
        };
    </script>
</body>
</html> 
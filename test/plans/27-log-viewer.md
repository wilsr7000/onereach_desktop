# 27 -- Log Viewer

## Overview

Standalone event log viewer with multi-dimensional filtering, AI-powered analysis, Cursor prompt generation, and export functionality. Connects to the Log Server on port 47292.

**Key files:** `log-viewer.html`, `preload-log-viewer.js`

## Prerequisites

- App running with Log Server active on port 47292
- Diagnostic logging enabled in Settings
- Some log entries generated (app startup produces these automatically)

## Features

### Log Display
- Monospace-styled log entries
- Color-coded left borders: debug (gray), info (blue), warn (yellow), error (red)
- Each entry shows: timestamp, level badge, source badge, test info badge, function badge, message
- Expandable "Show details" toggle for raw JSON data per entry

### Filtering
- Level toggle buttons: Debug, Info, Warn, Error (toggleable, color-coded)
- Source filter dropdown: All, Main Process, Renderer
- Window filter dropdown: dynamically populated from log entries
- Function/method filter: dynamically populated
- Test area filter: dynamically populated
- Full-text search input across log messages

### Auto-Refresh
- Polls every 5 seconds when enabled
- Toggle checkbox to enable/disable
- Refresh button for manual refresh

### Log Stats
- Total entries count
- Current log file name
- File size display

### Export
- Export modal with options:
  - Time range: 1 hour, 6 hours, 24 hours, 7 days, All
  - Format: JSON or Plain Text
  - Include debug toggle
- Download exported file

### AI Analysis
- "Analyze with AI" sends logs to Claude
- AI Analysis modal shows:
  - Summary of findings
  - Issues list with severity badges
  - Patterns identified
  - Recommendations
- "Generate Cursor Prompt" creates a copyable prompt from the analysis
- Prompt is designed for Cursor to auto-fix identified issues

---

## Checklist

### Window Lifecycle
- [ ] [A] Log Viewer opens via menu (Cmd+Shift+L in test mode) or IPC
- [ ] [A] Window loads without console errors
- [ ] [A] Window connects to Log Server on port 47292
- [ ] [A] Window closes cleanly

### Log Display
- [ ] [A] Log entries load on window open via `logViewer.getRecentLogs()`
- [ ] [P] Entries show timestamp, level badge, message
- [ ] [P] Level badges have correct colors (gray/blue/yellow/red)
- [ ] [P] Source badges show Main/Renderer origin
- [ ] [M] "Show details" toggle reveals raw JSON data

### Filtering -- Level
- [ ] [M] Debug toggle hides/shows debug entries
- [ ] [M] Info toggle hides/shows info entries
- [ ] [M] Warn toggle hides/shows warn entries
- [ ] [M] Error toggle hides/shows error entries
- [ ] [M] Multiple levels can be toggled simultaneously

### Filtering -- Dropdowns
- [ ] [P] Source dropdown filters by Main Process / Renderer
- [ ] [P] Window dropdown populates from log data
- [ ] [P] Function dropdown populates from log data
- [ ] [P] Test area dropdown populates from log data
- [ ] [P] Selecting a filter narrows displayed entries

### Search
- [ ] [M] Search input filters entries by text content
- [ ] [M] Search is case-insensitive
- [ ] [M] Clearing search restores all entries

### Auto-Refresh
- [ ] [A] Auto-refresh polls every 5 seconds when enabled
- [ ] [M] Toggle checkbox enables/disables auto-refresh
- [ ] [M] Refresh button loads latest entries immediately

### Log Stats
- [ ] [A] `logViewer.getLogStats()` returns stats
- [ ] [P] Total entries count is accurate
- [ ] [P] Current file name displays
- [ ] [P] File size displays

### Export
- [ ] [M] "Export Logs" button opens export modal
- [ ] [M] Time range selector offers 5 options
- [ ] [M] Format selector offers JSON and Text
- [ ] [M] Include debug toggle works
- [ ] [A] `logViewer.exportLogs()` generates export data
- [ ] [P] Downloaded file contains correct log data in selected format

### AI Analysis
- [ ] [M] "Analyze with AI" button triggers analysis
- [ ] [P] Analysis modal opens with loading state
- [ ] [P] Summary section displays findings
- [ ] [P] Issues list shows severity badges
- [ ] [P] Patterns section displays identified patterns
- [ ] [P] Recommendations section shows actionable items
- [ ] [M] "Generate Cursor Prompt" creates copyable prompt text
- [ ] [M] Prompt text is selectable and copyable

### IPC Integration
- [ ] [A] `logViewer.getRecentLogs(100)` returns up to 100 entries
- [ ] [A] `logViewer.getLogStats()` returns valid stats object
- [ ] [A] `logViewer.getLogFiles()` returns file list
- [ ] [A] `logViewer.exportLogs({ timeRange: '1h', format: 'json' })` returns data
- [ ] [A] `logViewer.analyzeLogsWithAI()` returns analysis object

---

## Automation Notes

- Window lifecycle testable via IPC
- Log entries are generated by app startup -- no special setup needed
- Filter UI interactions testable via Playwright page evaluations
- Export can be verified by checking the returned data structure
- AI analysis requires an API key and costs money -- mock for CI
- Auto-refresh timing can be verified with polling checks
- Level toggle testing: load entries, toggle off a level, verify count decreases
